---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/patterns/percent_of_total.html
---

<div class="document">
      <h1>
        <a id="percent-of-total" class="header-link anchor" href="#percent-of-total">
          Percent of Total
        </a>
      </h1>
    <p>In order to compute a percentage of total, you essentially have to run two queries, one for
the total and one where you wish to apply the calculation.  In Malloy, you can run these queries at
at the same time and combine them.</p>
<p>Let's suppose we wanted to look at our flight data by carrier and compute the percentage of all
flight performed by a particular carrier.</p>

      <h2>
        <a id="query-for-all-flights-ever-made" class="header-link anchor" href="#query-for-all-flights-ever-made">
          Query for all flights ever made
        </a>
      </h2>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{<span class="token keyword">aggregate</span>: flight_count}</pre><div class="result-outer small">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">37,561,525</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div>
      <h2>
        <a id="query-for-flights-by-carrier" class="header-link anchor" href="#query-for-flights-by-carrier">
          Query for Flights By Carrier
        </a>
      </h2>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
  <span class="token keyword">aggregate</span>: flight_count
}</pre><div class="result-outer medium">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div>
      <h2>
        <a id="in-malloy-can-make-both-caculations-at-once-with-a-href-nesting-html-em-nested-subtables-em-a-" class="header-link anchor" href="#in-malloy-can-make-both-caculations-at-once-with-a-href-nesting-html-em-nested-subtables-em-a-">
          In Malloy, can make both caculations at once with <a href="nesting.html"><em>nested subtables</em></a>.
        </a>
      </h2>
    <p>The results are returned as a single row in a table with two columns, <code class="language-malloy">flight_count</code> and <code class="language-malloy">main_query</code>.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">aggregate</span>: flight_count
  <span class="token keyword">nest</span>: main_query <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
    <span class="token keyword">aggregate</span>: flight_count
  }
}</pre><div class="result-outer medium">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">main_&#8203;query</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">37,561,525</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div>
      <h2>
        <a id="use-em-project-em-to-flatten-the-table-and-cross-join" class="header-link anchor" href="#use-em-project-em-to-flatten-the-table-and-cross-join">
          Use <em>project</em> to flatten the table and cross join
        </a>
      </h2>
    <p>Using a pipeline with a <code class="language-malloy"><span class="token keyword">project</span></code> calculation to combine (essentially cross joining) the queries back into a single table.
We also add an additional column, the percentage of total calculation.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">aggregate</span>: flight_count
  <span class="token keyword">nest</span>: main_query <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
    <span class="token keyword">aggregate</span>: flight_count
  }
}<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">project</span>: <span class="token punctuation">[</span>
    main_query<span class="token punctuation">.</span>nickname
    main_query<span class="token punctuation">.</span>flight_count
    flight_count_as_a_percent_of_total <span class="token keyword">is</span> main_query<span class="token punctuation">.</span>flight_count<span class="token operator">/</span>flight_count <span class="token operator">*</span> <span class="token number">100.0</span>
  <span class="token punctuation">]</span>
}
</pre><div class="result-outer medium">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count_&#8203;as_&#8203;a_&#8203;percent_&#8203;of_&#8203;total</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15.377</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.922</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.807</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9.73</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.535</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.213</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6.101</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5.309</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.684</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.214</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.927</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.546</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.274</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.009</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.845</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.363</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.338</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.713</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.503</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.277</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.173</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.142</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div>
      <h2>
        <a id="using-a-em-wildcard-em-against-the-nested-query" class="header-link anchor" href="#using-a-em-wildcard-em-against-the-nested-query">
          Using a <em>wildcard</em> against the Nested Query
        </a>
      </h2>
    <p>We can use a wildcard against the nested query to to make this pattern easier to write.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">aggregate</span>: flight_count
  <span class="token keyword">nest</span>: main_query <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
    <span class="token keyword">aggregate</span>: flight_count
  }
}<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">project</span>: <span class="token punctuation">[</span>
    main_query<span class="token punctuation">.</span><span class="token operator">*</span>
    flight_count_as_a_percent_of_total <span class="token keyword">is</span> main_query<span class="token punctuation">.</span>flight_count<span class="token operator">/</span>flight_count <span class="token operator">*</span> <span class="token number">100.0</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer medium">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count_&#8203;as_&#8203;a_&#8203;percent_&#8203;of_&#8203;total</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15.377</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.922</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.807</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9.73</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.535</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.213</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6.101</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5.309</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.684</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.214</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.927</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.546</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.274</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.009</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.845</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.363</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.338</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.713</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.503</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.277</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.173</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.142</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div></div>