---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/language/join.html
---

<div class="document">
      <h1>
        <a id="joins" class="header-link anchor" href="#joins">
          Joins
        </a>
      </h1>
    <p>Currently, all joins in Malloy are left outer joins, and must be between the primary key of one table and a foreign key in the <a href="explore.html">explore</a> being joined to.</p>

      <h2>
        <a id="join-types" class="header-link anchor" href="#join-types">
          Join Types
        </a>
      </h2>
    
      <h3>
        <a id="foreign-key-to-primary-key" class="header-link anchor" href="#foreign-key-to-primary-key">
          Foreign Key to Primary Key
        </a>
      </h3>
    <p>To join a foreign key of the source explore to the <code class="language-malloy">primary <span class="token keyword">key</span></code> of a joined explore, reference the foreign key by name in the <code class="language-malloy"><span class="token keyword">on</span></code> clause.</p>
<pre class="language-malloy">order_items <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.ecomm.order_items'</span>
  order_items <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> user_id
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h3>
        <a id="primary-key-to-foreign-key" class="header-link anchor" href="#primary-key-to-foreign-key">
          Primary Key to Foreign Key
        </a>
      </h3>
    <p>To join the <code class="language-malloy">primary <span class="token keyword">key</span></code> of the source explore to a foreign key on a joined explore, reference the field from the joined explore in the <code class="language-malloy"><span class="token keyword">on</span></code> clause.</p>
<pre class="language-malloy">users <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.ecomm.users'</span>
  primary <span class="token keyword">key</span> id
  order_items <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> order_items<span class="token punctuation">.</span>user_id
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h2>
        <a id="naming-joined-explores" class="header-link anchor" href="#naming-joined-explores">
          Naming Joined Explores
        </a>
      </h2>
    <p>To preserve the name of the explore being joined in, use <code class="language-malloy"><span class="token keyword">join</span> <span class="token keyword">on</span></code>.</p>
<pre class="language-malloy">flights <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.flights'</span>
  primary <span class="token keyword">key</span> id2
  carriers <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> carrier
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>To give the joined explore a different name within the source explore, specify the name of the explore being joined in between <code class="language-malloy"><span class="token keyword">join</span></code> and <code class="language-malloy"><span class="token keyword">on</span></code>.</p>
<pre class="language-malloy">flights <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.flights'</span>
  primary <span class="token keyword">key</span> id2
  origin_airport <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> origin
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h2>
        <a id="inlining-joins" class="header-link anchor" href="#inlining-joins">
          Inlining Joins
        </a>
      </h2>
    <p>Explores do not need to be named before they are used in a join.</p>
<pre class="language-malloy">order_items <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.ecomm.order_items'</span>
  users <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.users'</span>
    primary <span class="token keyword">key</span> id
  <span class="token punctuation">)</span> <span class="token keyword">on</span> user_id
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h2>
        <a id="using-fields-in-joined-explores" class="header-link anchor" href="#using-fields-in-joined-explores">
          Using Fields in Joined Explores
        </a>
      </h2>
    <p>When an explore is joined in, it becomes a nested field within the source explore. Fields within the joined explore can be referenced by first naming the joined explore, then accessing a contained field using <code class="language-malloy"><span class="token punctuation">.</span></code>.</p>
<pre class="language-malloy"><span class="token keyword">explore</span> flights
<span class="token operator">|</span> <span class="token keyword">reduce</span>
  carriers<span class="token punctuation">.</span>nickname
  flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights
  | ^</div><p>Measures and queries defined in joined explores may be used in addition to dimensions.</p>
<pre class="language-malloy"><span class="token keyword">explore</span> flights
<span class="token operator">|</span> <span class="token keyword">reduce</span>
  destination_code
  carriers<span class="token punctuation">.</span>carrier_count</pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights
  | ^</div>
      <h2>
        <a id="join-example" class="header-link anchor" href="#join-example">
          Join Example
        </a>
      </h2>
    <p>This example demonstrates the definition of several different joins in a model and their use in a query.</p>
<pre class="language-malloy"><span class="token comment">/* Data about particular kinds of aircraft */</span>
<span class="token keyword">define</span> aircraft_models <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.aircraft_models'</span>
  primary <span class="token keyword">key</span> aircraft_model_code
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Individual airplanes */</span>
<span class="token keyword">define</span> aircraft <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.aircraft'</span>
  primary <span class="token keyword">key</span> tail_num
  aircraft_models <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> aircraft_model_code
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* The airports that the aircraft fly to and from */</span>
<span class="token keyword">define</span> airports <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.airports'</span>
  primary <span class="token keyword">key</span> code
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Each individual flight */</span>
<span class="token keyword">define</span> flights <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.flights'</span>
    aircraft <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> tail_num
    origin_airport <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> origin
    destination_airport <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> destination
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">explore</span> flights : <span class="token punctuation">[</span>
  dep_time : <span class="token date">@2003-01</span><span class="token punctuation">,</span>
  origin_airport<span class="token punctuation">.</span>code : <span class="token string">'SJC'</span>
<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">reduce</span>
  destination_code <span class="token keyword">is</span> destination_airport<span class="token punctuation">.</span>code
  flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  aircraft_count <span class="token keyword">is</span> aircraft<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  aircraft_model_count <span class="token keyword">is</span> aircraft<span class="token punctuation">.</span>aircraft_models<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: mismatched input 'define' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | define aircraft_models is (explore 'malloy-data.faa.aircraft_models'
  | ^</div><p>For more examples and how to reason about aggregation across joins, review the <a href="aggregates.html">Aggregates</a> section.</p>
</div>