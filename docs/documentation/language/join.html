---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/language/join.html
---

<div class="document">
      <h1>
        <a id="joins" class="header-link anchor" href="#joins">
          Joins
        </a>
      </h1>
    <p>Joins in malloy are different than SQL joins.  Wnen two explores are joined,
Malloy retains the graph nature of the the data relationships. This is unlike
SQL, which flattens them all into a single table space.</p>
<p><a href="aggregates.html">Aggregate calculations</a> use this graph to deduce
a locality of computation, so they always work regardless of join pattern.</p>
<p>In Malloy syntaxes for join are:</p>
<pre class="language-">    join_one: &lt;explore-name> [is &lt;explore-exp>] with &lt;foreign_key>
    join_one: &lt;explore-name> [is &lt;explore-exp>] [on &lt;boolean expression>]
    join_many: &lt;explore-name> [is &lt;explore-exp>] on &lt;boolean expression>
    join_cross: &lt;explore-name> [is &lt;explore-exp>] [on &lt;boolean expression>]</pre><p><code class="language-malloy">join_one:</code> - the table we are joining has one row for each row in the source table.</p>
<p><code class="language-malloy">join_many:</code> - the table we are joining has many rows for each row in the source table</p>
<p><code class="language-malloy">join_cross:</code> - the join is a cross product and there will be many rows in each side of the join.</p>
<p>Malloy's joins are left outer joins by default.
Since Malloy deals in graphs, some SQL Join types don't make sense (RIGHT JOIN, for example).</p>

      <h2>
        <a id="join-types" class="header-link anchor" href="#join-types">
          Join Types
        </a>
      </h2>
    
      <h3>
        <a id="foreign-key-to-primary-key" class="header-link anchor" href="#foreign-key-to-primary-key">
          Foreign Key to Primary Key
        </a>
      </h3>
    <p>The easiest, most error proof way to perform a join is with <code class="language-malloy">join_one:<span class="token operator">/</span>with</code>.  The basic syntax is:</p>
<p><code class="language-malloy">join_one: <span class="token operator">&lt;</span><span class="token keyword">explore</span><span class="token operator">></span> with <span class="token operator">&lt;</span>foreign_key<span class="token operator">></span></code></p>
<p>To join a foreign key of the source explore to the <code class="language-malloy">primary <span class="token keyword">key</span></code> of a joined explore, reference the foreign key by name in the <code class="language-malloy">with</code> clause.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: users <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.users'</span><span class="token punctuation">)</span>{
  <span class="token keyword">primary_key</span>: id
}

<span class="token keyword">explore</span>: order_items <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.order_items'</span><span class="token punctuation">)</span>{
  join_one: users with user_id
}</pre>
      <h2>
        <a id="naming-joined-explores" class="header-link anchor" href="#naming-joined-explores">
          Naming Joined Explores
        </a>
      </h2>
    <p>If no name is specified with <code class="language-malloy"><span class="token keyword">is</span></code>, the name of the join will be the name of the
explore being joined.</p>
<pre class="language-malloy">
<span class="token keyword">explore</span>: carriers <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.carriers'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: code
}

<span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span>{
  join_one: carriers with carrier
}</pre><p>To give the joined explore a different name within the source explore, use <code class="language-malloy"><span class="token keyword">is</span></code> to specify the name of the explore.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: airports <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: code
}

<span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span>{
  join_one: origin_airport <span class="token keyword">is</span> airports with origin
}</pre>
      <h2>
        <a id="inlining-joins" class="header-link anchor" href="#inlining-joins">
          Inlining Joins
        </a>
      </h2>
    <p>Explores do not need to be named before they are used in a join. if the join
uses <code class="language-malloy"><span class="token keyword">is</span></code> to give the join a name.</p>
<pre class="language-malloy">
<span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span>{
  join_one: carriers <span class="token keyword">is</span>  <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.carriers'</span><span class="token punctuation">)</span>{<span class="token keyword">primary_key</span>: code} with carrier
}</pre>
      <h2>
        <a id="using-fields-in-joined-explores" class="header-link anchor" href="#using-fields-in-joined-explores">
          Using Fields in Joined Explores
        </a>
      </h2>
    <p>When an explore is joined in, it becomes a nested field within the source explore. Fields within the joined explore can be referenced by first naming the joined explore, then accessing a contained field using <code class="language-malloy"><span class="token punctuation">.</span></code>.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
  <span class="token keyword">aggregate</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer large">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div><p>Measures and queries defined in joined explores may be used in addition to dimensions.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">group_by</span>: destination_code
  <span class="token keyword">aggregate</span>: carriers<span class="token punctuation">.</span>carrier_count
}</pre><div class="result-outer large">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">destination_&#8203;code</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">carrier_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LAS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">19</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LAX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">19</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PHX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">18</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SFO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">18</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PIT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">18</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div>
      <h2>
        <a id="join-example" class="header-link anchor" href="#join-example">
          Join Example
        </a>
      </h2>
    <p>This example demonstrates the definition of several different joins in a model and their use in a query.
Entire subtrees of data can be joined.  In the example below, <code class="language-malloy">aircraft</code> joins <code class="language-malloy">aircraft_models</code>.  <code class="language-malloy">flights</code>
jois aircraft (which already has a join to aircraft manufacturer).  The tree nature of the join relationship
retained.</p>
<p><code class="language-malloy"><span class="token keyword">group_by</span>: aircraft<span class="token punctuation">.</span>aircraft_models<span class="token punctuation">.</span>manufacturer</code></p>
<pre class="language-malloy"><span class="token keyword">explore</span>: aircraft_models <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.aircraft_models'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: aircraft_model_code
  <span class="token keyword">measure</span>: aircraft_model_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}

<span class="token comment">/* Individual airplanes */</span>
<span class="token keyword">explore</span>: aircraft <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.aircraft'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: tail_num
  <span class="token keyword">measure</span>: aircraft_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  join_one: aircraft_models with aircraft_model_code
}

<span class="token comment">/* The airports that the aircraft fly to and from */</span>
<span class="token keyword">explore</span>: airports <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: code
  <span class="token keyword">measure</span>: airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}

<span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> {
  join_one: origin_airport <span class="token keyword">is</span> airports with origin
  join_one: destination_airport <span class="token keyword">is</span> airports with destination
  join_one: aircraft with tail_num
}

<span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">group_by</span>: aircraft<span class="token punctuation">.</span>aircraft_models<span class="token punctuation">.</span>manufacturer
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    aircraft_count <span class="token keyword">is</span> aircraft<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    aircraft_model_count <span class="token keyword">is</span> aircraft<span class="token punctuation">.</span>aircraft_models<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer large">
    <div class="result-middle">
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">manufacturer</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">aircraft_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">aircraft_&#8203;model_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BOEING</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">16,020,923</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,403</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">120</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,773,031</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">EMBRAER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,174,815</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">602</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MCDONNELL DOUGLAS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,047,321</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">470</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRBUS INDUSTRIE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,780,924</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">407</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
  </div><p>For more examples and how to reason about aggregation across joins, review the <a href="aggregates.html">Aggregates</a> section.</p>

      <h2>
        <a id="sql-joins" class="header-link anchor" href="#sql-joins">
          SQL Joins
        </a>
      </h2>
    <p>Inner join are joins where the the joind table has rows.  The example below, suppose we only want users that have at least one row in the orders table.  The following is the equivalent of a SQL  INNER JOIN.</p>
<pre class="language-malloy"><span class="token keyword">explore</span> users <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span> {
  join_many: orders <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'orders'</span><span class="token punctuation">)</span> <span class="token keyword">on</span> id<span class="token operator">=</span>orders<span class="token punctuation">.</span>user_id <span class="token keyword">and</span> orders<span class="token punctuation">.</span>user_id <span class="token operator">!=</span> <span class="token keyword">null</span>
}</pre></div>