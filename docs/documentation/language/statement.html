---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/language/statement.html
---

<div class="document">
      <h1>
        <a id="models" class="header-link anchor" href="#models">
          Models
        </a>
      </h1>
    <p>Malloy recognizes modeling as a key aspect of data analytics and
provides tools that allow for modularity and reusability of definitions.
Whereas in SQL, queries generally define all metrics inline,
requiring useful snippets to be saved and managed separately, in Malloy,
<em>dimensions</em>, <em>measures</em>, and <em>queries</em> can be saved and attached to a
modeled <em>explore</em>.</p>

      <h2>
        <a id="explores" class="header-link anchor" href="#explores">
          Explores
        </a>
      </h2>
    <p>A Malloy model file can contain several <em>explores</em>, which define fields that can be
used in queries.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> {
  <span class="token keyword">dimension</span>: distance_km <span class="token keyword">is</span> distance <span class="token operator">/</span> <span class="token number">1.609344</span>

  <span class="token keyword">measure</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">query</span>: by_carrier <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: carrier
    <span class="token keyword">aggregate</span>: flight_count
  }
}</pre><p>See <a href="explore.html">here</a> for more information on explores.</p>

      <h2>
        <a id="queries" class="header-link anchor" href="#queries">
          Queries
        </a>
      </h2>
    
      <h3>
        <a id="using-modeled-in-query-" class="header-link anchor" href="#using-modeled-in-query-">
          Using modeled in query.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> by_carrier</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">UA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">US</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"WN"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">5775777</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"DL"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4477929</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4434727</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"UA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3654646</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"US"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3205810</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   flights<span class="token punctuation">.</span>carrier <span class="token keyword">as</span> carrier<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="using-modeled-with-a-filter-" class="header-link anchor" href="#using-modeled-with-a-filter-">
          Using modeled with a filter.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights { <span class="token keyword">where</span>: origin <span class="token operator">=</span> <span class="token string">'SFO'</span> } <span class="token operator">-</span><span class="token operator">></span> by_carrier</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">UA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">338,723</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">105,581</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">82,468</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">44,694</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">32,351</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"UA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">338723</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"OO"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">105581</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">82468</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"DL"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">44694</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AS"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">32351</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   flights<span class="token punctuation">.</span>carrier <span class="token keyword">as</span> carrier<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>flights<span class="token punctuation">.</span>origin<span class="token operator">=</span><span class="token string">'SFO'</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> <span class="token punctuation">(</span>flights<span class="token punctuation">.</span>origin<span class="token operator">=</span><span class="token string">'SFO'</span><span class="token punctuation">)</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="setting-a-limit-on-the-query" class="header-link anchor" href="#setting-a-limit-on-the-query">
          Setting a limit on the Query
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights { <span class="token keyword">where</span>: origin <span class="token operator">=</span> <span class="token string">'SFO'</span> } <span class="token operator">-</span><span class="token operator">></span> by_carrier { <span class="token keyword">limit</span>: <span class="token number">2</span> }</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">UA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">338,723</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">105,581</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"UA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">338723</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"OO"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">105581</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   flights<span class="token punctuation">.</span>carrier <span class="token keyword">as</span> carrier<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">WHERE</span> flights<span class="token punctuation">.</span>origin<span class="token operator">=</span><span class="token string">'SFO'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
<span class="token keyword">LIMIT</span> <span class="token number">2</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="creating-a-brand-new-query-" class="header-link anchor" href="#creating-a-brand-new-query-">
          Creating a brand new Query.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: destination
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    flight_count
    average_distance_in_km <span class="token keyword">is</span> distance_km<span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">destination</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">average_&#8203;distance_&#8203;in_&#8203;km</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORD</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,036,343</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">480.732</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,963,535</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">403.987</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DFW</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,812,062</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">490.644</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LAX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,300,241</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">631.292</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PHX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,059,054</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">554.576</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"ORD"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2036343</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">480.7323051917169</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"ATL"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1963535</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">403.9874441585174</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"DFW"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1812062</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">490.64446861037715</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"LAX"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1300241</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">631.2922437299273</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"PHX"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1059054</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">554.5763958814941</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   flights<span class="token punctuation">.</span>destination <span class="token keyword">as</span> destination<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span>
   <span class="token function">AVG</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>distance<span class="token operator">/</span><span class="token number">1.609344</span><span class="token punctuation">)</span> <span class="token keyword">as</span> average_distance_in_km
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="putting-it-all-together-" class="header-link anchor" href="#putting-it-all-together-">
          Putting it all together.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: destination
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    flight_count
    average_distance_in_km <span class="token keyword">is</span> distance_km<span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">nest</span>: top_carriers <span class="token keyword">is</span> by_carrier { <span class="token keyword">limit</span>: <span class="token number">2</span> }
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">destination</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">average_&#8203;distance_&#8203;in_&#8203;km</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">top_&#8203;carriers</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORD</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,036,343</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">480.732</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">UA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,774</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">597,817</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,963,535</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">403.987</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,247,710</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">EV</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">288,405</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DFW</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,812,062</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">490.644</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">968,201</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MQ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">379,017</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LAX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,300,241</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">631.292</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">UA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">272,279</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">243,946</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PHX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,059,054</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">554.576</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">carrier</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HP</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">433,442</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">381,772</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"ORD"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2036343</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">480.7323051917193</span><span class="token punctuation">,</span>
    <span class="token property">"top_carriers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"UA"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">754774</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AA"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">597817</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"ATL"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1963535</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">403.98744415851627</span><span class="token punctuation">,</span>
    <span class="token property">"top_carriers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"DL"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1247710</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"EV"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">288405</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"DFW"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1812062</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">490.6444686103773</span><span class="token punctuation">,</span>
    <span class="token property">"top_carriers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"AA"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">968201</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"MQ"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">379017</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"LAX"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1300241</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">631.2922437299294</span><span class="token punctuation">,</span>
    <span class="token property">"top_carriers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"UA"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">272279</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"WN"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">243946</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"destination"</span><span class="token operator">:</span> <span class="token string">"PHX"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1059054</span><span class="token punctuation">,</span>
    <span class="token property">"average_distance_in_km"</span><span class="token operator">:</span> <span class="token number">554.5763958814887</span><span class="token punctuation">,</span>
    <span class="token property">"top_carriers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"HP"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">433442</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"carrier"</span><span class="token operator">:</span> <span class="token string">"WN"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">381772</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    flights<span class="token punctuation">.</span>destination <span class="token keyword">as</span> destination__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">AVG</span><span class="token punctuation">(</span>flights<span class="token punctuation">.</span>distance<span class="token operator">/</span><span class="token number">1.609344</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> average_distance_in_km__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> flights<span class="token punctuation">.</span>carrier <span class="token keyword">END</span> <span class="token keyword">as</span> carrier__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
  destination__0 <span class="token keyword">as</span> destination<span class="token punctuation">,</span>
  ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> flight_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span>
  ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> average_distance_in_km__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> average_distance_in_km<span class="token punctuation">,</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>carrier__1 <span class="token keyword">as</span> carrier<span class="token punctuation">,</span> flight_count__1 <span class="token keyword">as</span> flight_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  flight_count__1 <span class="token keyword">desc</span>  <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> top_carriers
<span class="token keyword">FROM</span> __stage0
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>See <a href="query.html">here</a> for more information on queries.</p>
</div>