---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/visualizations/segment_maps.html
---

<div class="document">
      <h1>
        <a id="segment-maps" class="header-link anchor" href="#segment-maps">
          Segment Maps
        </a>
      </h1>
    <p>The plugin currently supports US maps. Segement maps take as input 4 columns: start latitude , start longitude, end latitude, and  end longitude of the segment.  The model and data styles for the subsequent examples are:</p>
<pre class="language-malloy"><span class="token keyword">define</span> airports <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.airports'</span>
  primary <span class="token keyword">key</span> code
  airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">define</span> flights <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.flights'</span>
  primary <span class="token keyword">key</span> id2

  origin_code renames origin
  destination_code renames destination
  origin <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> origin_code<span class="token punctuation">,</span>
  destination <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> destination_code

  flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  routes_map <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">reduce</span>
    origin<span class="token punctuation">.</span>latitude
    origin<span class="token punctuation">.</span>longitude
    latitude2 <span class="token keyword">is</span> destination<span class="token punctuation">.</span>latitude
    longitude2 <span class="token keyword">is</span> destination<span class="token punctuation">.</span>longitude
    flight_count
  <span class="token punctuation">)</span>


<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>and data styles are</p>
<pre class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"routes_map"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"renderer"</span><span class="token operator">:</span> <span class="token string">"segment_map"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre>
      <h2>
        <a id="run-as-a-simple-query" class="header-link anchor" href="#run-as-a-simple-query">
          Run as a simple query
        </a>
      </h2>
    <p>Departing from Chicago</p>
<pre class="language-malloy"><span class="token keyword">explore</span> flights : <span class="token punctuation">[</span>dep_time : <span class="token date">@2003-02</span><span class="token punctuation">,</span> origin<span class="token punctuation">.</span>code : <span class="token string">'ORD'</span><span class="token punctuation">]</span>
<span class="token operator">|</span> routes_map</pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights : [dep_time : @2003-02, origin.code : 'ORD']
  | ^</div>
      <h2>
        <a id="run-as-a-nested-subtable" class="header-link anchor" href="#run-as-a-nested-subtable">
          Run as a nested subtable
        </a>
      </h2>
    <pre class="language-malloy"><span class="token keyword">explore</span> flights : <span class="token punctuation">[</span>dep_time : <span class="token date">@2003-02</span><span class="token punctuation">,</span> origin<span class="token punctuation">.</span>code : <span class="token string">'ORD'</span><span class="token punctuation">]</span>
<span class="token operator">|</span> <span class="token keyword">reduce</span>
  routes_map</pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights : [dep_time : @2003-02, origin.code : 'ORD']
  | ^</div>
      <h2>
        <a id="run-as-a-trellis" class="header-link anchor" href="#run-as-a-trellis">
          Run as a trellis
        </a>
      </h2>
    <p>By calling the configured map as a nested query, a trellis is formed.</p>
<pre class="language-malloy"><span class="token keyword">explore</span> flights : <span class="token punctuation">[</span>dep_time : <span class="token date">@2003-02</span><span class="token punctuation">,</span> origin<span class="token punctuation">.</span>code : <span class="token string">'ORD'</span><span class="token punctuation">]</span>
<span class="token operator">|</span> <span class="token keyword">reduce</span>
  carrier
  flight_count
  routes_map</pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights : [dep_time : @2003-02, origin.code : 'ORD']
  | ^</div>
      <h2>
        <a id="run-as-a-trellis-repeated-with-different-filters" class="header-link anchor" href="#run-as-a-trellis-repeated-with-different-filters">
          Run as a trellis, repeated with different filters
        </a>
      </h2>
    <pre class="language-malloy"><span class="token keyword">explore</span> flights : <span class="token punctuation">[</span>dep_time : <span class="token date">@2003-02</span><span class="token punctuation">]</span>
<span class="token operator">|</span> <span class="token keyword">reduce</span> : <span class="token punctuation">[</span>origin<span class="token punctuation">.</span>code : <span class="token string">'ORD'</span><span class="token operator">|</span><span class="token string">'SFO'</span><span class="token operator">|</span><span class="token string">'JFK'</span><span class="token punctuation">]</span>
  carrier
  flight_count
   ord <span class="token keyword">is</span> routes_map : <span class="token punctuation">[</span> origin<span class="token punctuation">.</span>code: <span class="token string">'ORD'</span><span class="token punctuation">]</span>
   sfo <span class="token keyword">is</span> routes_map : <span class="token punctuation">[</span> origin<span class="token punctuation">.</span>code: <span class="token string">'SFO'</span><span class="token punctuation">]</span>
   jfk <span class="token keyword">is</span> routes_map : <span class="token punctuation">[</span> origin<span class="token punctuation">.</span>code: <span class="token string">'JFK'</span><span class="token punctuation">]</span>
</pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights : [dep_time : @2003-02]
  | ^</div></div>