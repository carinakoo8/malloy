---
layout: documentation
title: Malloy Documentation
footer: /generated/footers/examples/ga_sessions.html
---

<div class="document">
      <h1>
        <a id="google-analytics" class="header-link anchor" href="#google-analytics">
          Google Analytics
        </a>
      </h1>
    <p><em>You can find the complete source code for this model <a href="https://github.com/looker-open-source/malloy/blob/docs-release/samples/ga_sessions/ga_sessions.malloy">here</a>.</em></p>
<p>Start by defining an explore based on a query.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: ga_sesions <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'bigquery-public-data.google_analytics_sample.ga_sessions_20170801'</span><span class="token punctuation">)</span>{
  <span class="token keyword">dimension</span>: start_time <span class="token keyword">is</span> <span class="token function">cast</span><span class="token punctuation">(</span>timestamp_seconds<span class="token function"></span><span class="token punctuation">(</span>visitStartTime<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token type">timestamp</span><span class="token punctuation">)</span>
  <span class="token keyword">measure</span>: <span class="token punctuation">[</span>
    user_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token function_keyword">distinct</span> fullVisitorId<span class="token punctuation">)</span>
    session_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    total_visits <span class="token keyword">is</span> totals<span class="token punctuation">.</span>visits<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    total_hits <span class="token keyword">is</span> totals<span class="token punctuation">.</span>hits<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    total_page_views <span class="token keyword">is</span> totals<span class="token punctuation">.</span>pageviews<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    total_productRevenue <span class="token keyword">is</span> hits<span class="token punctuation">.</span>product<span class="token punctuation">.</span>productRevenue<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    sold_count <span class="token keyword">is</span> hits<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> {<span class="token keyword">where</span>: hits<span class="token punctuation">.</span>product<span class="token punctuation">.</span>productQuantity : <span class="token operator">></span><span class="token number">0</span>}
  <span class="token punctuation">]</span>
}</pre><p>We can then add a few named queries to the model to easily access or reference elsewhere.</p>
<pre class="language-malloy">  <span class="token keyword">query</span>: by_region <span class="token keyword">is</span> {
    <span class="token keyword">top</span>: <span class="token number">10</span>
    <span class="token keyword">where</span>: geoNetwork<span class="token punctuation">.</span>region <span class="token operator">!</span><span class="token operator">~</span> <span class="token string">'%demo%'</span>
    <span class="token keyword">group_by</span>: geoNetwork<span class="token punctuation">.</span>region
    <span class="token keyword">aggregate</span>: user_count
  }

  <span class="token keyword">query</span>: by_device <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: device<span class="token punctuation">.</span>browser
    <span class="token keyword">aggregate</span>: user_count
    <span class="token keyword">group_by</span>: device<span class="token punctuation">.</span>deviceCategory
  }

  <span class="token keyword">query</span>: by_source <span class="token keyword">is</span> {
    <span class="token keyword">top</span>: <span class="token number">10</span>
    <span class="token keyword">where</span>: trafficSource<span class="token punctuation">.</span>source <span class="token operator">!=</span> <span class="token string">'(direct)'</span>
    <span class="token keyword">group_by</span>: trafficSource<span class="token punctuation">.</span>source
    <span class="token keyword">aggregate</span>: hits_count <span class="token keyword">is</span> hits<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  }
</pre>
      <h2>
        <a id="putting-it-all-together" class="header-link anchor" href="#putting-it-all-together">
          Putting it all together
        </a>
      </h2>
    <pre class="language-malloy"><span class="token keyword">query</span>: sessions_dashboard <span class="token keyword">is</span> ga_sessions <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">nest</span>: <span class="token punctuation">[</span>
    by_region
    <span class="token punctuation">,</span> by_device
    <span class="token punctuation">,</span> by_source
    <span class="token punctuation">,</span> by_category <span class="token keyword">is</span> {
        <span class="token keyword">group_by</span>: category <span class="token keyword">is</span> hits<span class="token punctuation">.</span>product<span class="token punctuation">.</span>v2ProductCategory
        <span class="token keyword">aggregate</span>: total_productRevenue
        <span class="token keyword">aggregate</span>: sold_count
    }
  <span class="token punctuation">]</span>
}</pre><div class="error">Error: TypeError: Cannot read property 'pipeHead' of undefined</div></div>