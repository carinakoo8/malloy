<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <img src="/malloy/img/logo.png" alt="malloy logo"/>
          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <form onSubmit="() => alert('submit')" action="/malloy/search">
          <div class="search-input-outer">
            <img src="/malloy/img/search.svg" alt="search"/>
            <input placeholder="Search" id="search-input" name="query" />
          </div>
          <input type="submit" style="display: none" />
        </form>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
    <div>
        <div id=getting_started class="sidebar-section-title collapsed">Getting Started<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/index.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/features.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/samples.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Sample Models
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/connection_instructions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Connecting a Database
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=language_reference class="sidebar-section-title collapsed">Language Reference<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/language/overview.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Introduction
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/basic.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Malloy Quickstart
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/statement.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/explore.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Explores
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/query.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/fields.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/types.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Types
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/expressions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/order_by.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/join.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/filters.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/nesting.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Nested Queries
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/aggregates.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/imports.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=common_patterns class="sidebar-section-title collapsed">Common Patterns<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/yoy.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Year Over Year Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/foreign_sums.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
<div class='sidebar-item active'>
              <a href="/malloy/documentation/patterns/percent_of_total.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/cohorts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/pivot_limits.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Pivot Limits
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/sessionize.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Sessionized Data
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=rendering_results class="sidebar-section-title collapsed">Rendering Results<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/dashboards.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Tables and Dashboards
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/bar_charts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/charts_line_chart.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/shape_maps.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/segment_maps.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/scatter_charts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=examples class="sidebar-section-title collapsed">Examples<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/ecommerce.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                eCommerce Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/faa.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                NTSB Flight Database
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/names.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Name Game
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/ga_sessions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Google Analytics GA360
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=walkthrough:_iowa liquor class="sidebar-section-title collapsed">Walkthrough: Iowa Liquor<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/iowa.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                About the Data Set
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/source.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Malloy Data Model
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step2.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Basic Calculations
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step2a.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Analysis: Products and Brands
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step3.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Bucketing and Mapping
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step6.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=walkthrough:_wordle solver class="sidebar-section-title collapsed">Walkthrough: Wordle Solver<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Just Words
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle1a.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Letters and Positioning
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle2.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Letter Frequency
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle3.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Scoring Words
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle4.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Final Model
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle5.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Solving Puzzles
              </a>
            </div>
          </div>
      </div>

  </div>
        <script src="/malloy/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
            <div class="linear-navigation">
    <div class="item">
      <a href="foreign_sums.html"><img src="/malloy/img/previous.svg" alt="previous"/>Foreign Sums and Averages</a>
    </div>
    <div class="item">
      <a href="cohorts.html">Cohort Analysis<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div>
            
          </div>
          <div class="document-outer">
            <div class="document">
      <h1>
        <a id="percent-of-total" class="header-link anchor" href="#percent-of-total">
          Percent of Total
        </a>
      </h1>
    <p>In order to compute a percentage of total, you essentially have to run two queries, one for
the total and one where you wish to apply the calculation.  In Malloy, you can run these queries at
at the same time and combine them.</p>
<p>Let's suppose we wanted to look at our flight data by carrier and compute the percentage of all
flight performed by a particular carrier.</p>

      <h2>
        <a id="query-for-all-flights-ever-made" class="header-link anchor" href="#query-for-all-flights-ever-made">
          Query for all flights ever made
        </a>
      </h2>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> { <span class="token keyword">aggregate</span>: flight_count }</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">37,561,525</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">37561525</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="query-for-flights-by-carrier" class="header-link anchor" href="#query-for-flights-by-carrier">
          Query for Flights By Carrier
        </a>
      </h2>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
  <span class="token keyword">aggregate</span>: flight_count
}</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Southwest"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">5775777</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Delta"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4477929</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4434727</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"United"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3654646</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"USAir"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3205810</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Northwest"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3084902</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American Eagle"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2291445</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1994049</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Sky West"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1383880</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"America West"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1207381</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental Express"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1099556</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Alaska"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">956492</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Southeast"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">854062</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Comair"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">754598</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Coast"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">692987</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"TWA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">511824</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Airtran"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">502561</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Jetblue"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">267963</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"ATA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">188769</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Hawaiian"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">104091</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Aloha"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">64834</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">53242</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   carriers_0<span class="token punctuation">.</span>nickname <span class="token keyword">as</span> nickname<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>carriers<span class="token punctuation">`</span> <span class="token keyword">AS</span> carriers_0 <span class="token keyword">ON</span> flights<span class="token punctuation">.</span>carrier <span class="token operator">=</span> carriers_0<span class="token punctuation">.</span>code
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="in-malloy-can-make-both-calculations-at-once-with-a-href-nesting-html-em-nested-subtables-em-a-" class="header-link anchor" href="#in-malloy-can-make-both-calculations-at-once-with-a-href-nesting-html-em-nested-subtables-em-a-">
          In Malloy, can make both calculations at once with <a href="nesting.html"><em>nested subtables</em></a>.
        </a>
      </h2>
    <p>The results are returned as a single row in a table with two columns, <code class="language-malloy">flight_count</code> and <code class="language-malloy">main_query</code>.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: flight_count
  <span class="token keyword">nest</span>: main_query <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
    <span class="token keyword">aggregate</span>: flight_count
  }
}</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">main_&#8203;query</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">37,561,525</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">37561525</span><span class="token punctuation">,</span>
    <span class="token property">"main_query"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Southwest"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">5775777</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Delta"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4477929</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4434727</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"United"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3654646</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"USAir"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3205810</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Northwest"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3084902</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American Eagle"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2291445</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1994049</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Sky West"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1383880</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"America West"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1207381</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental Express"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1099556</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Alaska"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">956492</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Southeast"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">854062</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Comair"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">754598</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Coast"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">692987</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"TWA"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">511824</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Airtran"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">502561</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Jetblue"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">267963</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"ATA"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">188769</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Hawaiian"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">104091</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Aloha"</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">64834</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">53242</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> carriers_0<span class="token punctuation">.</span>nickname <span class="token keyword">END</span> <span class="token keyword">as</span> nickname__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>carriers<span class="token punctuation">`</span> <span class="token keyword">AS</span> carriers_0 <span class="token keyword">ON</span> flights<span class="token punctuation">.</span>carrier <span class="token operator">=</span> carriers_0<span class="token punctuation">.</span>code
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
  ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> flight_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>nickname__1 <span class="token keyword">as</span> nickname<span class="token punctuation">,</span> flight_count__1 <span class="token keyword">as</span> flight_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  flight_count__1 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> main_query
<span class="token keyword">FROM</span> __stage0
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="use-em-project-em-to-flatten-the-table-and-cross-join" class="header-link anchor" href="#use-em-project-em-to-flatten-the-table-and-cross-join">
          Use <em>project</em> to flatten the table and cross join
        </a>
      </h2>
    <p>Using a pipeline with a <code class="language-malloy"><span class="token keyword">project</span></code> calculation to combine (essentially cross joining) the queries back into a single table.
We also add an additional column, the percentage of total calculation.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: flight_count
  <span class="token keyword">nest</span>: main_query <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
    <span class="token keyword">aggregate</span>: flight_count
  }
} <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">project</span>: <span class="token punctuation">[</span>
    main_query<span class="token punctuation">.</span>nickname
    main_query<span class="token punctuation">.</span>flight_count
    flight_count_as_a_percent_of_total <span class="token keyword">is</span> main_query<span class="token punctuation">.</span>flight_count <span class="token operator">/</span> flight_count <span class="token operator">*</span> <span class="token number">100.0</span>
  <span class="token punctuation">]</span>
}
</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count_&#8203;as_&#8203;a_&#8203;percent_&#8203;of_&#8203;total</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15.377</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.922</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.807</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9.73</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.535</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.213</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6.101</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5.309</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.684</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.214</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.927</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.546</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.274</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.009</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.845</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.363</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.338</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.713</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.503</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.277</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.173</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.142</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Southwest"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">5775777</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">15.376843725061748</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Delta"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4477929</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">11.921584653445247</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4434727</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">11.806568024061855</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"United"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3654646</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">9.729759374785768</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"USAir"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3205810</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">8.534823865644432</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Northwest"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3084902</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">8.212930651777317</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American Eagle"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2291445</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">6.100511094797136</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1994049</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">5.308754104099873</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Sky West"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1383880</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">3.684301955258739</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"America West"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1207381</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">3.2144088931426507</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental Express"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1099556</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.927346533454113</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Alaska"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">956492</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.546467429104649</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Southeast"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">854062</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.2737681710207456</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Comair"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">754598</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.0089652909459876</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Coast"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">692987</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">1.8449384043911956</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"TWA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">511824</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">1.36262838103618</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Airtran"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">502561</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">1.3379675079752487</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Jetblue"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">267963</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.71339755241567</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"ATA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">188769</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.5025594674337637</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Hawaiian"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">104091</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.2771213362609745</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Aloha"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">64834</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.17260747533546628</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">53242</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.14174610855123693</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> carriers_0<span class="token punctuation">.</span>nickname <span class="token keyword">END</span> <span class="token keyword">as</span> nickname__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>carriers<span class="token punctuation">`</span> <span class="token keyword">AS</span> carriers_0 <span class="token keyword">ON</span> flights<span class="token punctuation">.</span>carrier <span class="token operator">=</span> carriers_0<span class="token punctuation">.</span>code
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>
<span class="token punctuation">)</span>
<span class="token punctuation">,</span> __stage1 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> flight_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span>
    ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>nickname__1 <span class="token keyword">as</span> nickname<span class="token punctuation">,</span> flight_count__1 <span class="token keyword">as</span> flight_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  flight_count__1 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> main_query
  <span class="token keyword">FROM</span> __stage0
  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> 
   main_query_0<span class="token punctuation">.</span>nickname <span class="token keyword">as</span> nickname<span class="token punctuation">,</span>
   main_query_0<span class="token punctuation">.</span>flight_count <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span>
   <span class="token punctuation">(</span>main_query_0<span class="token punctuation">.</span>flight_count<span class="token operator">/</span>base<span class="token punctuation">.</span>flight_count<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100.0</span> <span class="token keyword">as</span> flight_count_as_a_percent_of_total
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>__stage1<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token punctuation">,</span> UNNEST<span class="token punctuation">(</span>base<span class="token punctuation">.</span>main_query<span class="token punctuation">)</span> <span class="token keyword">as</span> main_query_0
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="using-a-em-wildcard-em-against-the-nested-query" class="header-link anchor" href="#using-a-em-wildcard-em-against-the-nested-query">
          Using a <em>wildcard</em> against the Nested Query
        </a>
      </h2>
    <p>We can use a wildcard against the nested query to to make this pattern easier to write.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: flight_count
  <span class="token keyword">nest</span>: main_query <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: carriers<span class="token punctuation">.</span>nickname
    <span class="token keyword">aggregate</span>: flight_count
  }
} <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">project</span>: <span class="token punctuation">[</span>
    main_query<span class="token punctuation">.</span><span class="token operator">*</span>
    flight_count_as_a_percent_of_total <span class="token keyword">is</span> main_query<span class="token punctuation">.</span>flight_count <span class="token operator">/</span> flight_count <span class="token operator">*</span> <span class="token number">100.0</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer medium">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">nickname</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count_&#8203;as_&#8203;a_&#8203;percent_&#8203;of_&#8203;total</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Southwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,775,777</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15.377</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Delta</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,477,929</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.922</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,434,727</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11.807</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">United</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,654,646</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9.73</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">USAir</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,205,810</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.535</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Northwest</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,084,902</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.213</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">American Eagle</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,291,445</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6.101</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,994,049</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5.309</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Sky West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,383,880</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.684</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">America West</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,207,381</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3.214</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Continental Express</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,099,556</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.927</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Alaska</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">956,492</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.546</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Southeast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">854,062</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.274</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Comair</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">754,598</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2.009</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Atlantic Coast</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">692,987</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.845</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TWA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511,824</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.363</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Airtran</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">502,561</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1.338</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Jetblue</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">267,963</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.713</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ATA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">188,769</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.503</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Hawaiian</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">104,091</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.277</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">Aloha</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">64,834</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.173</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53,242</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0.142</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Southwest"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">5775777</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">15.376843725061748</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Delta"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4477929</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">11.921584653445247</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4434727</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">11.806568024061855</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"United"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3654646</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">9.729759374785768</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"USAir"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3205810</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">8.534823865644432</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Northwest"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">3084902</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">8.212930651777317</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"American Eagle"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2291445</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">6.100511094797136</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1994049</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">5.308754104099873</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Sky West"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1383880</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">3.684301955258739</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"America West"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1207381</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">3.2144088931426507</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Continental Express"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1099556</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.927346533454113</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Alaska"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">956492</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.546467429104649</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Southeast"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">854062</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.2737681710207456</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Comair"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">754598</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">2.0089652909459876</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Atlantic Coast"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">692987</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">1.8449384043911956</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"TWA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">511824</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">1.36262838103618</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Airtran"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">502561</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">1.3379675079752487</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Jetblue"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">267963</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.71339755241567</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"ATA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">188769</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.5025594674337637</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Hawaiian"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">104091</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.2771213362609745</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"Aloha"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">64834</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.17260747533546628</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">53242</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count_as_a_percent_of_total"</span><span class="token operator">:</span> <span class="token number">0.14174610855123693</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> carriers_0<span class="token punctuation">.</span>nickname <span class="token keyword">END</span> <span class="token keyword">as</span> nickname__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> flight_count__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>carriers<span class="token punctuation">`</span> <span class="token keyword">AS</span> carriers_0 <span class="token keyword">ON</span> flights<span class="token punctuation">.</span>carrier <span class="token operator">=</span> carriers_0<span class="token punctuation">.</span>code
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>
<span class="token punctuation">)</span>
<span class="token punctuation">,</span> __stage1 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> flight_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span>
    ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>nickname__1 <span class="token keyword">as</span> nickname<span class="token punctuation">,</span> flight_count__1 <span class="token keyword">as</span> flight_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  flight_count__1 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> main_query
  <span class="token keyword">FROM</span> __stage0
  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> 
   main_query_0<span class="token punctuation">.</span>nickname <span class="token keyword">as</span> nickname<span class="token punctuation">,</span>
   main_query_0<span class="token punctuation">.</span>flight_count <span class="token keyword">as</span> flight_count<span class="token punctuation">,</span>
   <span class="token punctuation">(</span>main_query_0<span class="token punctuation">.</span>flight_count<span class="token operator">/</span>base<span class="token punctuation">.</span>flight_count<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100.0</span> <span class="token keyword">as</span> flight_count_as_a_percent_of_total
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>__stage1<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token punctuation">,</span> UNNEST<span class="token punctuation">(</span>base<span class="token punctuation">.</span>main_query<span class="token punctuation">)</span> <span class="token keyword">as</span> main_query_0
</pre>
      </div>
    </div>
  </div></div>
          </div>
        </div>
        <script src="/malloy/js/view_toggles.js"></script>
      </div>
    </div>
  </body>
</html>