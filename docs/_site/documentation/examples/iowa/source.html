<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <img src="/malloy/img/logo.png" alt="malloy logo"/>
          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <form onSubmit="() => alert('submit')" action="/malloy/search">
          <div class="search-input-outer">
            <img src="/malloy/img/search.svg" alt="search"/>
            <input placeholder="Search" id="search-input" name="query" />
          </div>
          <input type="submit" style="display: none" />
        </form>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
    <div>
        <div id=getting_started class="sidebar-section-title collapsed">Getting Started<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/malloy_by_example.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Malloy By Example
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/features.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/samples.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Sample Models
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/connection_instructions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Connecting a Database
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/index.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=language_reference class="sidebar-section-title collapsed">Language Reference<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/language/overview.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Introduction
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/basic.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Malloy Quickstart
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/statement.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/explore.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Explores
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/query.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/fields.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/types.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Types
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/expressions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/order_by.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/join.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/filters.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/nesting.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Nested Queries
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/aggregates.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/imports.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/sql_blocks.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                SQL Blocks
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=common_patterns class="sidebar-section-title collapsed">Common Patterns<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/yoy.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Year Over Year Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/foreign_sums.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/percent_of_total.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/cohorts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/pivot_limits.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Pivot Limits
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/sessionize.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Sessionized Data
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=rendering_results class="sidebar-section-title collapsed">Rendering Results<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/dashboards.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Tables and Dashboards
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/bar_charts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/charts_line_chart.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/shape_maps.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/segment_maps.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/scatter_charts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=examples class="sidebar-section-title collapsed">Examples<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/ecommerce.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                eCommerce Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/faa.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                NTSB Flight Database
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/names.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Name Game
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/ga_sessions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Google Analytics GA360
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=walkthrough:_iowa liquor class="sidebar-section-title collapsed">Walkthrough: Iowa Liquor<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/iowa.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                About the Data Set
              </a>
            </div>
<div class='sidebar-item active'>
              <a href="/malloy/documentation/examples/iowa/source.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Malloy Data Model
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step2.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Basic Calculations
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step2a.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Analysis: Products and Brands
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step3.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Bucketing and Mapping
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step6.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=walkthrough:_wordle solver class="sidebar-section-title collapsed">Walkthrough: Wordle Solver<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Just Words
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle1a.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Letters and Positioning
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle2.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Letter Frequency
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle3.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Scoring Words
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle4.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Final Model
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle5.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Solving Puzzles
              </a>
            </div>
          </div>
      </div>

  </div>
        <script src="/malloy/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
            <div class="linear-navigation">
    <div class="item">
      <a href="iowa.html"><img src="/malloy/img/previous.svg" alt="previous"/>About the Data Set</a>
    </div>
    <div class="item">
      <a href="step2.html">Basic Calculations<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div>
            
          </div>
          <div class="document-outer">
            <div class="document">
      <h1>
        <a id="iowa-liquor-malloy-model" class="header-link anchor" href="#iowa-liquor-malloy-model">
          Iowa Liquor Malloy Model
        </a>
      </h1>
    <p>This is the malloy model used for the Analysis example.  It should be used as an reference when looking at the <a href="step2.html">following sections</a>.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">explore</span><span style="color: #000000">: </span><span style="color: #001080">iowa</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;malloy-data.iowa_liquor_sales.sales_deduped&#39;</span><span style="color: #000000">){</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">-- dimensions</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">dimension</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">gross_margin</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #098658">100</span><span style="color: #000000"> * (</span><span style="color: #001080">state_bottle_retail</span><span style="color: #000000"> - </span><span style="color: #001080">state_bottle_cost</span><span style="color: #000000">) / </span><span style="color: #795E26">nullif</span><span style="color: #000000">(</span><span style="color: #001080">state_bottle_retail</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">price_per_100ml</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">state_bottle_retail</span><span style="color: #000000"> / </span><span style="color: #795E26">nullif</span><span style="color: #000000">(</span><span style="color: #001080">bottle_volume_ml</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">) * </span><span style="color: #098658">100</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">category_class</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">category_name</span><span style="color: #000000"> :</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;WHISKIES&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;(WHISK|SCOTCH|BOURBON|RYE)&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;VODKAS&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;VODKA&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;RUMS&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;RUM&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;TEQUILAS&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;TEQUILA&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;LIQUEURS&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;(LIQUE|AMARETTO|TRIPLE SEC)&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;BRANDIES&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;BRAND(I|Y)&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;GINS&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;GIN&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;SCHNAPPS&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> ~ </span><span style="color: #811F3F">r&#39;SCHNAP&#39;</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;OTHER&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">bottle_size</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">bottle_volume_ml</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;jumbo (over 1000ml)&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> &gt; </span><span style="color: #098658">1001</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">pick</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;liter-ish&#39;</span><span style="color: #000000"> </span><span style="color: #0000FF">when</span><span style="color: #000000"> &gt;= </span><span style="color: #098658">750</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;small or mini (under 750ml)&#39;</span></span>
<span class="line"><span style="color: #000000">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">-- measures</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_sale_dollars</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">sale_dollars</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">item_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #795E26">distinct</span><span style="color: #000000"> </span><span style="color: #001080">item_number</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_bottles</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">bottles_sold</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">line_item_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">avg_price_per_100ml</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">price_per_100ml</span><span style="color: #000000">.</span><span style="color: #795E26">avg</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">-- turtles</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">by_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">purchase_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">`date`</span><span style="color: #000000">.</span><span style="color: #0000FF">week</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">top_sellers_by_revenue</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">vendor_name</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">item_description</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_bottles</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">avg_price_per_100ml</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">most_expensive_products</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">avg_price_per_100ml</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">vendor_name</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">item_description</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_bottles</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">avg_price_per_100ml</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">by_vendor_bar_chart</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">vendor_name</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_bottles</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">by_class</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">category_class</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">item_count</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">by_category</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">category_name</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">item_count</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">by_sku</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">item_description</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">limit</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">vendor_dashboard</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">vendor_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(</span><span style="color: #795E26">distinct</span><span style="color: #000000"> </span><span style="color: #001080">vendor_number</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: [</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">total_bottles</span></span>
<span class="line"><span style="color: #000000">    ]</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_month</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_class</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_vendor_bar_chart</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_sellers_by_revenue</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">most_expensive_products</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_vendor_dashboard</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">vendor_name</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">total_sale_dollars</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_month</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">top_sellers_by_revenue</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">most_expensive_products</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre>
      <h2>
        <a id="schema-overview" class="header-link anchor" href="#schema-overview">
          Schema Overview
        </a>
      </h2>
    <p>The schema for the table <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">bigquery</span><span style="color: #000000">-</span><span style="color: #001080">public</span><span style="color: #000000">-</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #001080">iowa_liquor_sales</span><span style="color: #000000">.</span><span style="color: #001080">sales</span></span></code> as well as descriptions of each field can be found on the <a href="https://data.iowa.gov/Sales-Distribution/Iowa-Liquor-Sales/m3tr-qhgy">Iowa Data site</a>.</p>
</div>
          </div>
        </div>
        <script src="/malloy/js/view_toggles.js"></script>
      </div>
    </div>
  </body>
</html>