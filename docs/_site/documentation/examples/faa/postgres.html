<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/malloy/img/favicon.ico"
    />
    <script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-0M10W7C20Y"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-0M10W7C20Y");
</script>

  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <img src="/malloy/img/logo.png" alt="malloy logo" />
          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <form onSubmit="() => alert('submit')" action="/malloy/search">
          <div class="search-input-outer">
            <img src="/malloy/img/search.svg" alt="search" />
            <input placeholder="Search" id="search-input" name="query" />
          </div>
          <input type="submit" style="display: none" />
        </form>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <div id=getting_started
        class="sidebar-section-title collapsed"
      >
        Getting Started
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/index.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        About Malloy
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/malloy_by_example.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Malloy By Example
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/basic.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Quickstart
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/features.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Key Features
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/samples.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Sample Models
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/connection_instructions.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Connecting a Database
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/tao.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        The Tao of Malloy
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=language_reference
        class="sidebar-section-title collapsed"
      >
        Language Reference
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/language/overview.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Introduction
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/sql_to_malloy.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        SQL to Malloy
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/statement.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Models
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/source.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Sources
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/query.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Queries
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/fields.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Fields
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/aggregates.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Aggregates
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/filters.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Filters
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/order_by.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Ordering and Limiting
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/join.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Joins
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/nesting.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Nested Queries
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/expressions.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Expressions
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/sql_blocks.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        SQL Blocks
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/imports.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Imports
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/types.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Types
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/changelog.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Change Log
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=rendering_results
        class="sidebar-section-title collapsed"
      >
        Rendering Results
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/dashboards.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Intro: Charts & Dashboards
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/bar_charts.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Bar Charts
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/charts_line_chart.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Line Charts
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/scatter_charts.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Scatter Charts
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/shape_maps.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Shape Maps
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/segment_maps.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Segment Maps
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=common_patterns
        class="sidebar-section-title collapsed"
      >
        Common Patterns
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/yoy.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Year Over Year Analysis
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/foreign_sums.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Foreign Sums and Averages
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/percent_of_total.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Percent of Total
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/cohorts.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Cohort Analysis
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/pivot_limits.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Pivot Limits
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/sessionize.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Sessionized Data
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=examples
        class="sidebar-section-title collapsed"
      >
        Examples
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class="sidebar-section">
      <div id=ntsb_flight database
        class="sidebar-section-title collapsed"
      >
        NTSB Flight Database
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/examples/faa/bigquery.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        FAA Dashboards
      </a>
    </div>
<div class='sidebar-item active'>
      <a href="/malloy/documentation/examples/faa/postgres.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Connect with Postgres
      </a>
    </div>
      </div>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/ecommerce.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        eCommerce Analysis
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/names.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        The Name Game
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/ga_sessions.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Google Analytics GA360
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=walkthrough:_iowa liquor
        class="sidebar-section-title collapsed"
      >
        Walkthrough: Iowa Liquor
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/iowa.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        About the Data Set
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/source.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        The Malloy Data Model
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step2.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Basic Calculations
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step2a.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Analysis: Products and Brands
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step3.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Bucketing and Mapping
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step6.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Dashboards
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=walkthrough:_wordle solver
        class="sidebar-section-title collapsed"
      >
        Walkthrough: Wordle Solver
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Just Words
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle1a.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Letters and Positioning
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle2.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Letter Frequency
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle3.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Scoring Words
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle4.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Final Model
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle5.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Solving Puzzles
      </a>
    </div>
      </div>
    </div>
  </div>
        <script src="/malloy/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
             <div class="linear-navigation">
    <div class="item">
      <a href="bigquery.html"><img src="/malloy/img/previous.svg" alt="previous"/>FAA Dashboards</a>
    </div>
    <div class="item">
      <a href="../ecommerce.html">eCommerce Analysis<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div> 
          </div>
          <div class="document-outer"><div class="document">
      <h1>
        <a id="ntsb-flight-database-examples-postgresql-" class="header-link anchor" href="#ntsb-flight-database-examples-postgresql-">
          NTSB Flight Database Examples (PostgreSQL)
        </a>
      </h1>
    <p><em>This page adapts the NTSB Flight Database examples <a href="https://malloydata.github.io/malloy/documentation/examples/faa.html">here</a> to work with a Postgres instance rather than requiring BigQuery access.  Note that full support for Postgres is in progress and that date/time support is currently incomplete.</em></p>

      <h2>
        <a id="postgresql-setup" class="header-link anchor" href="#postgresql-setup">
          PostgreSQL Setup
        </a>
      </h2>
    <p>Before you can run these NTSB sample models against a Postgres instance, you need to start up / connect to a database server instance and load it with the appropriate data.  These steps setup a database with the NTSB Flight dataset and respective sample models.  These steps use Docker for convenience, but the instructions can be modified to run a Postgres instance directly.</p>

      <h3>
        <a id="start-a-local-postgres-instance" class="header-link anchor" href="#start-a-local-postgres-instance">
          Start a local Postgres instance
        </a>
      </h3>
    <p>Start a Docker container running Postgres</p>
<pre class="language-txt" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">docker run --name malloy-postgres -e POSTGRES_PASSWORD=password -d -p 5432:5432 postgres</span></span>
<span class="line"><span style="color: #000000"></span></span></pre>
      <h3>
        <a id="load-the-ntsb-dataset-into-postgres" class="header-link anchor" href="#load-the-ntsb-dataset-into-postgres">
          Load the NTSB dataset into Postgres
        </a>
      </h3>
    <p>From the <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">malloy</span><span style="color: #000000">/</span></span></code> root directory of the repository, unzip the SQL script that will load the NTSB Flight dataset</p>
<pre class="language-txt" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">gunzip test/data/postgres/malloytest-postgres.sql.gz</span></span>
<span class="line"><span style="color: #000000"></span></span></pre><p>Copy the SQL data file into the container</p>
<pre class="language-txt" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">docker cp test/data/postgres/malloytest-postgres.sql malloy-postgres:/malloytest-postgres.sql</span></span>
<span class="line"><span style="color: #000000"></span></span></pre><p>Run the file in the container</p>
<pre class="language-txt" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">docker exec -it malloy-postgres psql -U postgres -f malloytest-postgres.sql</span></span>
<span class="line"><span style="color: #000000"></span></span></pre>
      <h2>
        <a id="connect-to-postgres-in-the-extension" class="header-link anchor" href="#connect-to-postgres-in-the-extension">
          Connect to Postgres in the extension
        </a>
      </h2>
    <p>Use the connection settings shown below to connect the VS Code extension to your local Postgres instance.</p>
<p><img src="https://user-images.githubusercontent.com/25882507/179831294-b6a69ef6-f454-48a7-8b93-aec2bff0ff3f.png" alt="postgres-connection-example"/></p>

      <h2>
        <a id="modify-the-example-malloy-models-to-work-with-postgres" class="header-link anchor" href="#modify-the-example-malloy-models-to-work-with-postgres">
          Modify the example Malloy models to work with Postgres
        </a>
      </h2>
    <p>The sample models from the NTSB Flight Dataset <a href="https://malloydata.github.io/malloy/documentation/examples/faa.html#the-malloy-model">here</a> reference public BigQuery tables using the standard <em>project_name.dataset_name.table_name</em> BigQuery format.  Therefore, all the data source references with this format need to be changed to the Postgres format.</p>

      <h3>
        <a id="change-data-source-references" class="header-link anchor" href="#change-data-source-references">
          Change data source references
        </a>
      </h3>
    <p>All source data references prefixed with <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">malloy</span><span style="color: #000000">-</span><span style="color: #001080">data</span><span style="color: #000000">.</span><span style="color: #001080">faa</span><span style="color: #000000">.</span></span></code> must be changed to <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">malloytest</span><span style="color: #000000">.</span></span></code> (since that is the Postgres schema we used above) to conform to Malloy's Postgres <em>schema_name.table_name</em> format (the database name is not required).  Simply find and replace in VS Code or run <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">sed</span><span style="color: #000000"> -</span><span style="color: #001080">i</span><span style="color: #000000"> -</span><span style="color: #001080">e</span><span style="color: #000000"> </span><span style="color: #A31515">&#39;s/malloy-data.faa./malloytest./g&#39;</span><span style="color: #000000"> </span><span style="color: #001080">path</span><span style="color: #000000">/</span><span style="color: #0000FF">to</span><span style="color: #000000">/&lt;</span><span style="color: #001080">your_file</span><span style="color: #000000">.</span><span style="color: #001080">malloy</span><span style="color: #000000">&gt;</span></span></code></p>
<p><img src="https://user-images.githubusercontent.com/25882507/179834102-eef4aee4-973a-4259-bfe4-1487179012b3.png" alt="source_table_reference"/></p>

      <h2>
        <a id="the-updated-malloy-model" class="header-link anchor" href="#the-updated-malloy-model">
          The Updated Malloy Model
        </a>
      </h2>
    <p>The follow example code will run against the local Postgres database.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;malloytest.airports&#39;</span><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">code</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">dimension</span><span style="color: #000000">: </span><span style="color: #001080">name</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">concat</span><span style="color: #000000">(</span><span style="color: #001080">code</span><span style="color: #000000">, </span><span style="color: #A31515">&#39; - &#39;</span><span style="color: #000000">, </span><span style="color: #001080">full_name</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">airport_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;malloytest.carriers&#39;</span><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">code</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">carrier_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_models</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;malloytest.aircraft_models&#39;</span><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_model_code</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_model_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">aircraft</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;malloytest.aircraft&#39;</span><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">tail_num</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_models</span><span style="color: #000000"> </span><span style="color: #AF00DB">with</span><span style="color: #000000"> </span><span style="color: #001080">aircraft_model_code</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_facts</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">from</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;malloytest.flights&#39;</span><span style="color: #000000">) -&gt; {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">tail_num</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">lifetime_flights</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">lifetime_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">distance</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">tail_num</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">dimension</span><span style="color: #000000">: </span><span style="color: #001080">lifetime_flights_bucketed</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #001080">lifetime_flights</span><span style="color: #000000"> / </span><span style="color: #098658">1000</span><span style="color: #000000">) * </span><span style="color: #098658">1000</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">source</span><span style="color: #000000">: </span><span style="color: #001080">flights</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">table</span><span style="color: #000000">(</span><span style="color: #A31515">&#39;malloytest.flights&#39;</span><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">primary_key</span><span style="color: #000000">: </span><span style="color: #001080">id2</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">rename</span><span style="color: #000000">: </span><span style="color: #001080">origin_code</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">origin</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">rename</span><span style="color: #000000">: </span><span style="color: #001080">destination_code</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000"> </span><span style="color: #AF00DB">with</span><span style="color: #000000"> </span><span style="color: #001080">carrier</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">origin</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">with</span><span style="color: #000000"> </span><span style="color: #001080">origin_code</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">destination</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">with</span><span style="color: #000000"> </span><span style="color: #001080">destination_code</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">aircraft</span><span style="color: #000000"> </span><span style="color: #AF00DB">with</span><span style="color: #000000"> </span><span style="color: #001080">tail_num</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">join_one</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_facts</span><span style="color: #000000"> </span><span style="color: #AF00DB">with</span><span style="color: #000000"> </span><span style="color: #001080">tail_num</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">measure</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">flight_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">total_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">sum</span><span style="color: #000000">(</span><span style="color: #001080">distance</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">seats_for_sale</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">sum</span><span style="color: #000000">(</span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">seats</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">seats_owned</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #795E26">sum</span><span style="color: #000000">(</span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">seats</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// average_seats is aircraft.aircraft_models.avg(aircraft.aircraft_models.seats)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// average_seats is aircraft.aircraft_models.seats.avg()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">measures</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">dest_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">origin_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// shows carriers and number of destinations (bar chart)</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">by_carrier</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000">.</span><span style="color: #001080">nickname</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">destination_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// shows year over year growth (line chart)</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">year_over_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">dep_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">month</span><span style="color: #000000">(</span><span style="color: #001080">dep_time</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">dep_year</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">year</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// shows plane manufacturers and frequency of use</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">by_manufacturer</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">manufacturer</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_count</span><span style="color: #000000">, </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">delay_by_hour_of_day</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">dep_delay</span><span style="color: #000000"> &gt; </span><span style="color: #098658">30</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">dep_hour</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">hour</span><span style="color: #000000">(</span><span style="color: #001080">dep_time</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">delay</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #001080">dep_delay</span><span style="color: #000000">) / </span><span style="color: #098658">30</span><span style="color: #000000"> * </span><span style="color: #098658">30</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">carriers_by_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">dep_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000">.</span><span style="color: #001080">nickname</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">seats_by_distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// seats rounded to 5</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">seats</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">seats</span><span style="color: #000000"> / </span><span style="color: #098658">5</span><span style="color: #000000">) * </span><span style="color: #098658">5</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// distance rounded to 20</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">distance</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">floor</span><span style="color: #000000">(</span><span style="color: #001080">distance</span><span style="color: #000000"> / </span><span style="color: #098658">20</span><span style="color: #000000">) * </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">routes_map</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">latitude</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">longitude</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">latitude2</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">latitude</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">longitude2</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">longitude</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">destinations_by_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">dep_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">name</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// query flights { where: origin.code ? &#39;SJC&#39; } -&gt; airport_dashboard</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">airport_dashboard</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">code</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination_code</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">destination</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">full_name</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">carriers_by_month</span><span style="color: #000000">, </span><span style="color: #001080">routes_map</span><span style="color: #000000">, </span><span style="color: #001080">delay_by_hour_of_day</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">plane_usage</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_count</span><span style="color: #000000"> &gt; </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">aircraft_facts</span><span style="color: #000000">.</span><span style="color: #001080">lifetime_flights_bucketed</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_count</span><span style="color: #000000">, </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_manufacturer</span><span style="color: #000000">, </span><span style="color: #001080">by_carrier</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// query: southwest_flights is carrier_dashboard { where: carriers.nickname  ? &#39;Southwest&#39; }</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">carrier_dashboard</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">destination_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_manufacturer</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">dep_month</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">month</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">hubs</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">where</span><span style="color: #000000">: </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span><span style="color: #000000"> &gt; </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">hub</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">name</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">destination_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination</span><span style="color: #000000">.</span><span style="color: #001080">airport_count</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">origin_dashboard</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">10</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">code</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">origin_code</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">origin</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">full_name</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">origin</span><span style="color: #000000">.</span><span style="color: #001080">city</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">destinations_by_month</span><span style="color: #000000">, </span><span style="color: #001080">routes_map</span><span style="color: #000000">, </span><span style="color: #001080">year_over_year</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">detail</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">30</span><span style="color: #000000"> </span><span style="color: #AF00DB">by</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">project</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #001080">id2</span><span style="color: #000000">, </span><span style="color: #001080">dep_time</span><span style="color: #000000">, </span><span style="color: #001080">tail_num</span><span style="color: #000000">, </span><span style="color: #001080">carrier</span><span style="color: #000000">, </span><span style="color: #001080">origin_code</span><span style="color: #000000">, </span><span style="color: #001080">destination_code</span><span style="color: #000000">, </span><span style="color: #001080">distance</span><span style="color: #000000">, </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_model_code</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// query that you might run for to build a flight search interface</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// query flights { where: origin.code = &#39;SJC&#39;, destination.code = &#39;LAX&#39; | &#39;BUR&#39;, dep_time ? @2004-01-01 } -&gt; kayak</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">kayak</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">carriers</span><span style="color: #000000">.</span><span style="color: #001080">nickname</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">by_hour</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">dep_hour</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">hour</span><span style="color: #000000">(</span><span style="color: #001080">dep_time</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">flights</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">dep_minute</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">minute</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">carriers</span><span style="color: #000000">.</span><span style="color: #001080">name</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">flight_num</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">origin_code</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">destination_code</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">manufacturer</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">aircraft</span><span style="color: #000000">.</span><span style="color: #001080">aircraft_models</span><span style="color: #000000">.</span><span style="color: #001080">model</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #008000">// example query that shows how you can build a map reduce job to sessionize flights</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">sessionize</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">flight_date</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">day</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">carrier</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">daily_flight_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">per_plane_data</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">top</span><span style="color: #000000">: </span><span style="color: #098658">20</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">tail_num</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">plane_flight_count</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">flight_count</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #AF00DB">nest</span><span style="color: #000000">: </span><span style="color: #001080">flight_legs</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">          </span><span style="color: #001080">tail_num</span></span>
<span class="line"><span style="color: #000000">          </span><span style="color: #001080">dep_minute</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">dep_time</span><span style="color: #000000">.</span><span style="color: #0000FF">minute</span></span>
<span class="line"><span style="color: #000000">          </span><span style="color: #001080">origin_code</span></span>
<span class="line"><span style="color: #000000">          </span><span style="color: #001080">dest_code</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #001080">destination_code</span></span>
<span class="line"><span style="color: #000000">          </span><span style="color: #001080">dep_delay</span></span>
<span class="line"><span style="color: #000000">          </span><span style="color: #001080">arr_delay</span></span>
<span class="line"><span style="color: #000000">      }</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre></div></div>
        </div>
        <script src="/malloy/js/view_toggles.js"></script>
      </div>
    </div>
    <div id="banner_wrapper">
  <div id="banner">
    <div>
      This site uses cookies from Google to deliver its services and to analyze
      traffic.
      <a
        href="https://policies.google.com/technologies/cookies"
        target="_blank"
      >
        Learn more
      </a>
    </div>
    <button id="banner_button">I Understand</button>
  </div>
</div>

    <script src="/malloy/js/banner.js"></script>
  </body>
</html>
