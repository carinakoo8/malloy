<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <img src="/malloy/img/logo.png" alt="malloy logo"/>
          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <form onSubmit="() => alert('submit')" action="/malloy/search">
          <div class="search-input-outer">
            <img src="/malloy/img/search.svg" alt="search"/>
            <input placeholder="Search" id="search-input" name="query" />
          </div>
          <input type="submit" style="display: none" />
        </form>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
    <div>
        <div id=getting_started class="sidebar-section-title collapsed">Getting Started<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/index.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Tao of Malloy
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/features.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Key Features
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/connection_instructions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Connecting a Database
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=language_reference class="sidebar-section-title collapsed">Language Reference<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/language/overview.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Introduction
              </a>
            </div>
<div class='sidebar-item active'>
              <a href="/malloy/documentation/language/basic.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Malloy Quickstart
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/statement.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Models
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/explore.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Explores
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/query.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Queries
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/fields.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Fields
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/types.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Types
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/expressions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Expressions
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/order_by.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Ordering and Limiting
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/join.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Joins
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/filters.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Filters
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/nesting.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Nested Queries
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/aggregates.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Aggregates
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/language/imports.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Imports
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=common_patterns class="sidebar-section-title collapsed">Common Patterns<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/yoy.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Year Over Year Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/foreign_sums.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Foreign Sums and Averages
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/percent_of_total.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Percent of Total
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/cohorts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Cohort Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/pivot_limits.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Pivot Limits
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/patterns/sessionize.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Sessionized Data
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=rendering_results class="sidebar-section-title collapsed">Rendering Results<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/dashboards.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Tables and Dashboards
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/bar_charts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Bar Charts
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/charts_line_chart.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Line Charts
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/shape_maps.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Shape Maps
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/segment_maps.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Segment Maps
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/visualizations/scatter_charts.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Scatter Charts
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=examples class="sidebar-section-title collapsed">Examples<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/ecommerce.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                eCommerce Analysis
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/faa.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                NTSB Flight Database
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/names.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Name Game
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/ga_sessions.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Google Analytics GA360
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=walkthrough:_iowa liquor class="sidebar-section-title collapsed">Walkthrough: Iowa Liquor<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/iowa.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                About the Data Set
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/source.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                The Malloy Data Model
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step2.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Basic Calculations
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step2a.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Analysis: Products and Brands
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step3.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Bucketing and Mapping
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/iowa/step6.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Dashboards
              </a>
            </div>
          </div>
      </div>
<div>
        <div id=walkthrough:_wordle solver class="sidebar-section-title collapsed">Walkthrough: Wordle Solver<img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/></div>
          <div class="sidebar-section-item-group">
          <div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Just Words
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle1a.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Letters and Positioning
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle2.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Letter Frequency
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle3.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Scoring Words
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle4.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Final Model
              </a>
            </div>
<div class='sidebar-item '>
              <a href="/malloy/documentation/examples/wordle/wordle5.html">
                <img src="/malloy/img/article_icon.svg" alt="document"/>
                Solving Puzzles
              </a>
            </div>
          </div>
      </div>

  </div>
        <script src="/malloy/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
            
            <div class="linear-navigation">
    <div class="item">
      <a href="overview.html"><img src="/malloy/img/previous.svg" alt="previous"/>Introduction</a>
    </div>
    <div class="item">
      <a href="statement.html">Models<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div>
            
          </div>
          <div class="document-outer">
            <div class="document">
      <h1>
        <a id="malloy-quickstart" class="header-link anchor" href="#malloy-quickstart">
          Malloy Quickstart
        </a>
      </h1>
    <p>This guide will introduce the basics of querying and modeling with Malloy.  Results here are shown in JSON.  Malloy has a rendering system that can render <a href="../visualizations/dashboards.html">results as tables, charts or dashboards</a>, but fundamentally the Malloy just returns data.</p>
<p><em>Note: If you'd like to follow along with this guide, you can create a new <code>.malloy</code> file and run these queries there.</em></p>

      <h2>
        <a id="leading-with-the-source" class="header-link anchor" href="#leading-with-the-source">
          Leading with the Source
        </a>
      </h2>
    <p>Queries are of the form "<em>source</em> <code class="language-malloy"><span class="token operator">-</span><span class="token operator">></span></code> <em>operation</em>"</p>
<p>In Malloy, the source of a query is either a raw table, a <a href="explore.html">modeled explore</a>, or another query.</p>
<p>In this example the <code class="language-malloy"><span class="token function">table</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code> function provides the query <em>source</em> from a table (or view) in the database.
They query <em>operation</em> is explicit about which fields are grouped, aggregated or projected.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,845</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">IL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">890</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">856</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">804</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1845</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">984</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"IL"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">890</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"FL"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">856</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"PA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">804</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>state <span class="token keyword">as</span> state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="query-operators" class="header-link anchor" href="#query-operators">
          Query Operators
        </a>
      </h2>
    <p>In SQL, the <code>SELECT</code> command does two very different things.  A <code>SELECT</code> with a <code>GROUP BY</code> aggregates data according to the <code>GROUP BY</code> clause and produces aggregate calculation against every calculation not in the <code>GROUP BY</code>.  In Malloy, the query operator for this is <code class="language-malloy"><span class="token keyword">group_by</span>:</code>.  Calculation about data in the group are made using <code class="language-malloy"><span class="token keyword">aggregate</span>:</code>.</p>
<p>The second type of <code>SELECT</code> in SQL does not perform any aggregation;  All rows in the input table, unless filtered in some way, show up in the output table. In Malloy, this command is called <code class="language-malloy"><span class="token keyword">project</span>:</code>.</p>
<p>In the query below, the data will be grouped by <code class="language-malloy">state</code> and will produce an aggregate calculation for <code class="language-malloy">airport_count</code> and <code class="language-malloy">average_elevation</code>.  <code class="language-malloy"><span class="token keyword">group_by</span>:</code>. The <code class="language-malloy"><span class="token keyword">aggregate</span>:</code> list can contain references to existing aggregate fields or add new aggregate computations.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: <span class="token punctuation">[</span>
    state
    county
  <span class="token punctuation">]</span>
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    average_elevation <span class="token keyword">is</span> <span class="token function">avg</span><span class="token punctuation">(</span>elevation<span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">average_&#8203;elevation</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">689.165</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HARRIS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">135</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">106.467</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AZ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MARICOPA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">117</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,395.667</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,376.056</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TARRANT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">63</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">646.794</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">176</span><span class="token punctuation">,</span>
    <span class="token property">"average_elevation"</span><span class="token operator">:</span> <span class="token number">689.164772727273</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"HARRIS"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">135</span><span class="token punctuation">,</span>
    <span class="token property">"average_elevation"</span><span class="token operator">:</span> <span class="token number">106.4666666666667</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"AZ"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MARICOPA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">117</span><span class="token punctuation">,</span>
    <span class="token property">"average_elevation"</span><span class="token operator">:</span> <span class="token number">1395.6666666666663</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">71</span><span class="token punctuation">,</span>
    <span class="token property">"average_elevation"</span><span class="token operator">:</span> <span class="token number">2376.056338028169</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TARRANT"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">63</span><span class="token punctuation">,</span>
    <span class="token property">"average_elevation"</span><span class="token operator">:</span> <span class="token number">646.7936507936511</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>state <span class="token keyword">as</span> state<span class="token punctuation">,</span>
   base<span class="token punctuation">.</span>county <span class="token keyword">as</span> county<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
   <span class="token function">AVG</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>elevation<span class="token punctuation">)</span> <span class="token keyword">as</span> average_elevation
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">3</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="multiple-field-operations" class="header-link anchor" href="#multiple-field-operations">
          Multiple Field Operations
        </a>
      </h3>
    <p>Multiple <code class="language-malloy"><span class="token keyword">group_by</span>:</code> and <code class="language-malloy"><span class="token keyword">aggregate</span>:</code> statements can appear in the same query operation.  This can be helpful in rendering when the order of fields in the query output is significant.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: fac_type
  <span class="token keyword">aggregate</span>: airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">group_by</span>: county
  <span class="token keyword">aggregate</span>: max_elevation <span class="token keyword">is</span> <span class="token function">max</span><span class="token punctuation">(</span>elevation<span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">max_&#8203;elevation</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">151</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,244</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">142</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WASHINGTON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5,105</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">110</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HARRIS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">774</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">105</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">JEFFERSON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8,040</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">98</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FRANKLIN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,728</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">151</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES"</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">3244</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">142</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"WASHINGTON"</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">5105</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">110</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"HARRIS"</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">774</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">105</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"JEFFERSON"</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">8040</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">98</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"FRANKLIN"</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">4728</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>fac_type <span class="token keyword">as</span> fac_type<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
   base<span class="token punctuation">.</span>county <span class="token keyword">as</span> county<span class="token punctuation">,</span>
   <span class="token function">max</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>elevation<span class="token punctuation">)</span> <span class="token keyword">as</span> max_elevation
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="project" class="header-link anchor" href="#project">
          Project
        </a>
      </h3>
    <p><code class="language-malloy"><span class="token keyword">project</span></code> produces a list of fields.  For every row in the input table, there is a row in the output table.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">project</span>: <span class="token punctuation">[</span> code<span class="token punctuation">,</span> full_name<span class="token punctuation">,</span> city<span class="token punctuation">,</span> county <span class="token punctuation">]</span>
  <span class="token keyword">where</span>: county <span class="token operator">=</span> <span class="token string">'SANTA CRUZ'</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">code</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">full_&#8203;name</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">city</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2AZ8</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TUBAC ULTRALIGHT FLIGHTPARK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TUBAC</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OLS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NOGALES INTL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NOGALES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NSI</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN NICOLAS ISLAND NOLF</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN NICOLAS ISLAND</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CL77</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BONNY DOON VILLAGE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA37</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DOMINICAN SANTA CRUZ HOSPITAL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"2AZ8"</span><span class="token punctuation">,</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"TUBAC ULTRALIGHT FLIGHTPARK"</span><span class="token punctuation">,</span>
    <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"TUBAC"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"OLS"</span><span class="token punctuation">,</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"NOGALES INTL"</span><span class="token punctuation">,</span>
    <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"NOGALES"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"NSI"</span><span class="token punctuation">,</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"SAN NICOLAS ISLAND NOLF"</span><span class="token punctuation">,</span>
    <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"SAN NICOLAS ISLAND"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"CL77"</span><span class="token punctuation">,</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"BONNY DOON VILLAGE"</span><span class="token punctuation">,</span>
    <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"CA37"</span><span class="token punctuation">,</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"DOMINICAN SANTA CRUZ HOSPITAL"</span><span class="token punctuation">,</span>
    <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span><span class="token punctuation">,</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>code <span class="token keyword">as</span> code<span class="token punctuation">,</span>
   base<span class="token punctuation">.</span>full_name <span class="token keyword">as</span> full_name<span class="token punctuation">,</span>
   base<span class="token punctuation">.</span>city <span class="token keyword">as</span> city<span class="token punctuation">,</span>
   base<span class="token punctuation">.</span>county <span class="token keyword">as</span> county
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">WHERE</span> base<span class="token punctuation">.</span>county<span class="token operator">=</span><span class="token string">'SANTA CRUZ'</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="everything-has-a-name" class="header-link anchor" href="#everything-has-a-name">
          Everything has a Name
        </a>
      </h2>
    <p>In Malloy, all output fields have names. This means that any time a query
introduces a new aggregate computation, it must be named. <em>(unlike SQL,
which allows un-named expressions)</em></p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: max_elevation <span class="token keyword">is</span> <span class="token function">max</span><span class="token punctuation">(</span>elevation<span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">max_&#8203;elevation</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12,442</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">12442</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   <span class="token function">max</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>elevation<span class="token punctuation">)</span> <span class="token keyword">as</span> max_elevation
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>Notice that Malloy uses the form "<em>name</em> <code class="language-malloy"><span class="token keyword">is</span></code> <em>value</em>" instead of SQL's "<em>value</em> <code class="language-malloy"><span class="token keyword">as</span></code> <em>name</em>".
Having the output column name written first makes it easier for someone reading
the code to visualize the resulting query structure.</p>
<p>Named objects, like columns from a table, and fields defined in an explore, can be included
in field lists without an <code class="language-malloy"><span class="token keyword">is</span></code></p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">project</span>: <span class="token punctuation">[</span>
    full_name
    elevation
  <span class="token punctuation">]</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">full_&#8203;name</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">elevation</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MILI</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">KILI</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MALOELAP</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">UTIRIK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NAMORIK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"MILI"</span><span class="token punctuation">,</span>
    <span class="token property">"elevation"</span><span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"KILI"</span><span class="token punctuation">,</span>
    <span class="token property">"elevation"</span><span class="token operator">:</span> <span class="token number">5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"MALOELAP"</span><span class="token punctuation">,</span>
    <span class="token property">"elevation"</span><span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"UTIRIK"</span><span class="token punctuation">,</span>
    <span class="token property">"elevation"</span><span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"full_name"</span><span class="token operator">:</span> <span class="token string">"NAMORIK"</span><span class="token punctuation">,</span>
    <span class="token property">"elevation"</span><span class="token operator">:</span> <span class="token number">15</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>full_name <span class="token keyword">as</span> full_name<span class="token punctuation">,</span>
   base<span class="token punctuation">.</span>elevation <span class="token keyword">as</span> elevation
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="expressions" class="header-link anchor" href="#expressions">
          Expressions
        </a>
      </h2>
    <p>Many SQL expressions will work unchanged in Malloy, and many functions available in Standard SQL are usable in Malloy as well. This makes expressions fairly straightforward to understand, given a knowledge of SQL.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: county_and_state <span class="token keyword">is</span> <span class="token function">concat</span><span class="token punctuation">(</span>county<span class="token punctuation">,</span> <span class="token string">', '</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    max_elevation <span class="token keyword">is</span> <span class="token function">max</span><span class="token punctuation">(</span>elevation<span class="token punctuation">)</span>
    min_elevation <span class="token keyword">is</span> <span class="token function">min</span><span class="token punctuation">(</span>elevation<span class="token punctuation">)</span>
    avg_elevation <span class="token keyword">is</span> <span class="token function">avg</span><span class="token punctuation">(</span>elevation<span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county_&#8203;and_&#8203;state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">max_&#8203;elevation</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">min_&#8203;elevation</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">avg_&#8203;elevation</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES, CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,420</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">0</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">689.165</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HARRIS, TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">135</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">774</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">106.467</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MARICOPA, AZ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">117</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3,995</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">737</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,395.667</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO, CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6,748</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">631</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,376.056</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TARRANT, TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">63</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">895</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">472</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">646.794</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES, CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">176</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">3420</span><span class="token punctuation">,</span>
    <span class="token property">"min_elevation"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"avg_elevation"</span><span class="token operator">:</span> <span class="token number">689.164772727273</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"HARRIS, TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">135</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">774</span><span class="token punctuation">,</span>
    <span class="token property">"min_elevation"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token property">"avg_elevation"</span><span class="token operator">:</span> <span class="token number">106.4666666666667</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"MARICOPA, AZ"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">117</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">3995</span><span class="token punctuation">,</span>
    <span class="token property">"min_elevation"</span><span class="token operator">:</span> <span class="token number">737</span><span class="token punctuation">,</span>
    <span class="token property">"avg_elevation"</span><span class="token operator">:</span> <span class="token number">1395.6666666666663</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO, CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">71</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">6748</span><span class="token punctuation">,</span>
    <span class="token property">"min_elevation"</span><span class="token operator">:</span> <span class="token number">631</span><span class="token punctuation">,</span>
    <span class="token property">"avg_elevation"</span><span class="token operator">:</span> <span class="token number">2376.056338028169</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"TARRANT, TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">63</span><span class="token punctuation">,</span>
    <span class="token property">"max_elevation"</span><span class="token operator">:</span> <span class="token number">895</span><span class="token punctuation">,</span>
    <span class="token property">"min_elevation"</span><span class="token operator">:</span> <span class="token number">472</span><span class="token punctuation">,</span>
    <span class="token property">"avg_elevation"</span><span class="token operator">:</span> <span class="token number">646.7936507936511</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   concat<span class="token punctuation">(</span>base<span class="token punctuation">.</span>county<span class="token punctuation">,</span><span class="token string">', '</span><span class="token punctuation">,</span>base<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token keyword">as</span> county_and_state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
   <span class="token function">max</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>elevation<span class="token punctuation">)</span> <span class="token keyword">as</span> max_elevation<span class="token punctuation">,</span>
   <span class="token function">min</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>elevation<span class="token punctuation">)</span> <span class="token keyword">as</span> min_elevation<span class="token punctuation">,</span>
   <span class="token function">AVG</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>elevation<span class="token punctuation">)</span> <span class="token keyword">as</span> avg_elevation
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>The basic types of Malloy expressions are <code class="language-malloy"><span class="token type">string</span></code>, <code class="language-malloy"><span class="token type">number</span></code>, <code class="language-malloy"><span class="token type">boolean</span></code>, <code class="language-malloy"><span class="token type">date</span></code>, and <code class="language-malloy"><span class="token type">timestamp</span></code>.</p>

      <h2>
        <a id="modeling-and-reuse" class="header-link anchor" href="#modeling-and-reuse">
          Modeling and Reuse
        </a>
      </h2>
    <p>One of the main benefits of Malloy is the ability to save common calculations into a data model.  In the example below, we create an <em>explore</em> object named <code class="language-malloy">airports</code> and
add a <code class="language-malloy"><span class="token keyword">dimension</span>:</code> calculation for <code class="language-malloy">county_and_state</code> and <code class="language-malloy"><span class="token keyword">measure</span>:</code> calculation for <code class="language-malloy">airport_count</code>.  Dimensions can be used in <code class="language-malloy"><span class="token keyword">group_by</span>:</code>, <code class="language-malloy"><span class="token keyword">project</span>:</code> and <code class="language-malloy"><span class="token keyword">where</span>:</code>.  Measures can be used in <code class="language-malloy"><span class="token keyword">aggregate</span>:</code> and <code class="language-malloy"><span class="token keyword">having</span>:</code>.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: airports <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> {
  <span class="token keyword">dimension</span>: county_and_state <span class="token keyword">is</span> <span class="token function">concat</span><span class="token punctuation">(</span>county<span class="token punctuation">,</span> <span class="token string">', '</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
  <span class="token keyword">measure</span>: airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">measure</span>: average_elevation <span class="token keyword">is</span> <span class="token function">avg</span><span class="token punctuation">(</span>elevation<span class="token punctuation">)</span>
}</pre><pre class="language-malloy"><span class="token keyword">query</span>: airports <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: county_and_state
  <span class="token keyword">aggregate</span>: airport_count
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county_&#8203;and_&#8203;state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES, CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HARRIS, TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">135</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MARICOPA, AZ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">117</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO, CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TARRANT, TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">63</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES, CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">176</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"HARRIS, TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">135</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"MARICOPA, AZ"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">117</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO, CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">71</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county_and_state"</span><span class="token operator">:</span> <span class="token string">"TARRANT, TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">63</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   concat<span class="token punctuation">(</span>airports<span class="token punctuation">.</span>county<span class="token punctuation">,</span><span class="token string">', '</span><span class="token punctuation">,</span>airports<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token keyword">as</span> county_and_state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> airports
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="ordering-and-limiting" class="header-link anchor" href="#ordering-and-limiting">
          Ordering and Limiting
        </a>
      </h2>
    <p>In Malloy, ordering and limiting work pretty much the same way they do in SQL, though Malloy introduces some <a href="order_by.html">reasonable defaults</a>.</p>
<p>The <code class="language-malloy"><span class="token keyword">top</span>:</code> and <code class="language-malloy"><span class="token keyword">limit</span>:</code> statements are synonyms and limits the number of rows returned. Results below are sorted by the first measure descending--in this case, <code class="language-malloy">airport_count</code>.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">top</span>: <span class="token number">2</span>
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,845</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1845</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">984</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>state <span class="token keyword">as</span> state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
<span class="token keyword">LIMIT</span> <span class="token number">2</span>
</pre>
      </div>
    </div>
  </div><p>Default ordering can be overridden with <code class="language-malloy"><span class="token keyword">order_by</span>:</code>, as in the following query, which shows the states in alphabetical order.  <code class="language-malloy"><span class="token keyword">order_by</span>:</code> can take a field index number or the name of a field.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">order_by</span>: state
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">null</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">23</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">608</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">260</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AR</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">299</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">23</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"AK"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">608</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"AL"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">260</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"AR"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">299</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"AS"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>state <span class="token keyword">as</span> state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">ASC</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="filtering" class="header-link anchor" href="#filtering">
          Filtering
        </a>
      </h2>
    <p>When working with data, filtering is something you do in almost every query. Malloy's filtering is more powerful and expressive than that of SQL. When querying data, we first isolate the data we are interested in (filter it) and then perform aggregations and calculations on the data we've isolated (shape it). Malloy provides consistent syntax for filtering everywhere within a query.</p>

      <h3>
        <a id="filtering-tables" class="header-link anchor" href="#filtering-tables">
          Filtering Tables
        </a>
      </h3>
    <p>A filter on a data source table narrows down which data is included to be passed to the Query Operation. This translates
to a <code>WHERE</code> clause in SQL.
In this case, the data from the table is filtered to just airports in California.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: state <span class="token operator">=</span> <span class="token string">'CA'</span> } <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">top</span>: <span class="token number">2</span>
  <span class="token keyword">group_by</span>: county
  <span class="token keyword">aggregate</span>: airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">176</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">71</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>county <span class="token keyword">as</span> county<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">WHERE</span> base<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'CA'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
<span class="token keyword">LIMIT</span> <span class="token number">2</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="filtering-measures" class="header-link anchor" href="#filtering-measures">
          Filtering Measures
        </a>
      </h3>
    <p>A filter on an aggregate calculation (a <em>measure</em>) narrows down the data used in that specific calculation. In the example below, the calculations for <code class="language-malloy">airports</code> and <code class="language-malloy">heliports</code> are filtered separately.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    airports <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: fac_type <span class="token operator">=</span> <span class="token string">'AIRPORT'</span> }
    heliports <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: fac_type <span class="token operator">=</span> <span class="token string">'HELIPORT'</span> }
    total <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airports</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">heliports</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">total</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,389</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">435</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,845</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">IL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">625</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">245</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">890</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">569</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">396</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OH</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">537</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">201</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">749</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">280</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">856</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airports"</span><span class="token operator">:</span> <span class="token number">1389</span><span class="token punctuation">,</span>
    <span class="token property">"heliports"</span><span class="token operator">:</span> <span class="token number">435</span><span class="token punctuation">,</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1845</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"IL"</span><span class="token punctuation">,</span>
    <span class="token property">"airports"</span><span class="token operator">:</span> <span class="token number">625</span><span class="token punctuation">,</span>
    <span class="token property">"heliports"</span><span class="token operator">:</span> <span class="token number">245</span><span class="token punctuation">,</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">890</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airports"</span><span class="token operator">:</span> <span class="token number">569</span><span class="token punctuation">,</span>
    <span class="token property">"heliports"</span><span class="token operator">:</span> <span class="token number">396</span><span class="token punctuation">,</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">984</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"OH"</span><span class="token punctuation">,</span>
    <span class="token property">"airports"</span><span class="token operator">:</span> <span class="token number">537</span><span class="token punctuation">,</span>
    <span class="token property">"heliports"</span><span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">,</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">749</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"FL"</span><span class="token punctuation">,</span>
    <span class="token property">"airports"</span><span class="token operator">:</span> <span class="token number">511</span><span class="token punctuation">,</span>
    <span class="token property">"heliports"</span><span class="token operator">:</span> <span class="token number">280</span><span class="token punctuation">,</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">856</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>state <span class="token keyword">as</span> state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> base<span class="token punctuation">.</span>fac_type<span class="token operator">=</span><span class="token string">'AIRPORT'</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airports<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> base<span class="token punctuation">.</span>fac_type<span class="token operator">=</span><span class="token string">'HELIPORT'</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> heliports<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> total
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="filtering-in-query-stages" class="header-link anchor" href="#filtering-in-query-stages">
          Filtering in Query Stages
        </a>
      </h3>
    <p>Filters can also be applied to any Query Operation. When using a filter in this way, it only applies to
the data for that operation alone. (More on this later, in the section on <code class="language-malloy"><span class="token keyword">nest</span>:</code> operations in queries.)</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">where</span>: state: <span class="token string">'AL'</span> <span class="token operator">|</span> <span class="token string">'KY'</span>
  <span class="token keyword">top</span>: <span class="token number">5</span>
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    airports  <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: fac_type: <span class="token string">'AIRPORT'</span> }
    heliports <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: fac_type: <span class="token string">'HELIPORT'</span> }
    total     <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airports</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">heliports</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">total</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">180</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">75</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">260</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">KY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">142</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">55</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">202</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"AL"</span><span class="token punctuation">,</span>
    <span class="token property">"airports"</span><span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">,</span>
    <span class="token property">"heliports"</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">260</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"KY"</span><span class="token punctuation">,</span>
    <span class="token property">"airports"</span><span class="token operator">:</span> <span class="token number">142</span><span class="token punctuation">,</span>
    <span class="token property">"heliports"</span><span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span>
    <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">202</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   base<span class="token punctuation">.</span>state <span class="token keyword">as</span> state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> base<span class="token punctuation">.</span>fac_type<span class="token operator">=</span><span class="token string">'AIRPORT'</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airports<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> base<span class="token punctuation">.</span>fac_type<span class="token operator">=</span><span class="token string">'HELIPORT'</span> <span class="token keyword">THEN</span> <span class="token number">1</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> heliports<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> total
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>base<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'AL'</span><span class="token punctuation">)</span><span class="token operator">or</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'KY'</span><span class="token punctuation">)</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
<span class="token keyword">LIMIT</span> <span class="token number">5</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="dates-and-timestamps" class="header-link anchor" href="#dates-and-timestamps">
          Dates and Timestamps
        </a>
      </h2>
    <p>Working with time in data is often needlessly complex; Malloy has built in constructs to simplify many time-related operations. This section gives a brief introduction to some of these tools, but for more details see the <a href="time-ranges.html">Time Ranges</a> section.</p>

      <h3>
        <a id="time-literals" class="header-link anchor" href="#time-literals">
          Time Literals
        </a>
      </h3>
    <p>Literals of type <code class="language-malloy"><span class="token type">date</span></code> and <code class="language-malloy"><span class="token type">timestamp</span></code> are notated with an <code class="language-malloy"><span class="token date">@</span></code>, e.g. <code class="language-malloy"><span class="token date">@2003-03-29</span></code> or <code class="language-malloy"><span class="token date">@1994-07-14 10:23:59</span></code>. Similarly, years (<code class="language-malloy"><span class="token date">@2021</span></code>), quarters (<code class="language-malloy"><span class="token date">@2020-Q1</span></code>), months (<code class="language-malloy"><span class="token date">@2019-03</span></code>), weeks (<code class="language-malloy"><span class="token date">@WK2021-08-01</span></code>), and minutes (<code class="language-malloy"><span class="token date">@2017-01-01 10:53</span></code>) can be expressed.</p>
<p>Time literals can be used as values, but are more often useful in filters. For example, the following query
shows the number of flights in 2003.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: dep_time: <span class="token date">@2003</span> } <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6,493,690</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">6493690</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>base<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2003-01-01'</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>dep_time<span class="token operator">&lt;</span><span class="token string">'2004-01-01'</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>There is a special time literal <code class="language-malloy">now</code>, referring to the current timestamp, which allows for relative time filters.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: dep_time <span class="token operator">></span> now <span class="token operator">-</span> <span class="token number">6</span> <span class="token timeframe">hours</span> } <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: flights_last_6_hours <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre>
      <h3>
        <a id="truncation" class="header-link anchor" href="#truncation">
          Truncation
        </a>
      </h3>
    <p>Time values can be truncated to a given timeframe, which can be <code class="language-malloy"><span class="token timeframe">second</span></code>, <code class="language-malloy"><span class="token timeframe">minute</span></code>, <code class="language-malloy"><span class="token timeframe">hour</span></code>, <code class="language-malloy"><span class="token timeframe">day</span></code>, <code class="language-malloy"><span class="token timeframe">week</span></code>, <code class="language-malloy"><span class="token timeframe">month</span></code>, <code class="language-malloy"><span class="token timeframe">quarter</span></code>, or <code class="language-malloy"><span class="token timeframe">year</span></code>.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: <span class="token punctuation">[</span>
    flight_year <span class="token keyword">is</span> dep_time<span class="token punctuation">.</span><span class="token timeframe">year</span>
    flight_month <span class="token keyword">is</span> dep_time<span class="token punctuation">.</span><span class="token timeframe">month</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">aggregate</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">flight_&#8203;year</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">flight_&#8203;month</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005-08</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">630,566</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005-06</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">608,955</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005-05</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">614,678</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005-01</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">594,779</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2005-03</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">617,328</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_month"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-08-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">630566</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_month"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-06-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">608955</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_month"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-05-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">614678</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_month"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">594779</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_year"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-01-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_month"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2005-03-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">617328</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>dep_time<span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">YEAR</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_year<span class="token punctuation">,</span>
   DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>dep_time<span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">MONTH</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_month<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="extraction" class="header-link anchor" href="#extraction">
          Extraction
        </a>
      </h3>
    <p>Numeric values can be extracted from time values, e.g. <code class="language-malloy"><span class="token timeframe">day_of_year</span><span class="token punctuation">(</span>some_date<span class="token punctuation">)</span></code> or <code class="language-malloy"><span class="token timeframe">minute</span><span class="token punctuation">(</span>some_time<span class="token punctuation">)</span></code>. See the full list of extraction functions <a href="time-ranges.html#extraction">here</a>.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">order_by</span>: <span class="token number">1</span>
  <span class="token keyword">group_by</span>: day_of_week <span class="token keyword">is</span> <span class="token timeframe">day</span><span class="token punctuation">(</span>dep_time<span class="token punctuation">)</span>
  <span class="token keyword">aggregate</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">day_&#8203;of_&#8203;week</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,220,298</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,232,955</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,229,187</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,221,663</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,229,545</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,238,003</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,242,262</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"day_of_week"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1220298</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"day_of_week"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1232955</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"day_of_week"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1229187</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"day_of_week"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1221663</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"day_of_week"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1229545</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"day_of_week"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1238003</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"day_of_week"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">1242262</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   EXTRACT<span class="token punctuation">(</span><span class="token keyword">DAY</span> <span class="token keyword">FROM</span> base<span class="token punctuation">.</span>dep_time<span class="token punctuation">)</span> <span class="token keyword">as</span> day_of_week<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">ASC</span>
</pre>
      </div>
    </div>
  </div><!-- TODO it may be worth having a doc describing what the JSON+Metadata
output of these look like, i.e. that the JSON just includes a regular date,
but the metadata specifies that it's in that given timeframe.
And likewise for any other data type that has interesting output metadata. -->
      <h3>
        <a id="time-ranges" class="header-link anchor" href="#time-ranges">
          Time Ranges
        </a>
      </h3>
    <p>Two kinds of time ranges are given special syntax: the range between two times and the range starting at some time for some duration. These are represented like <code class="language-malloy"><span class="token date">@2003</span> <span class="token keyword">to</span> <span class="token date">@2005</span></code> and <code class="language-malloy"><span class="token date">@2004-Q1</span> <span class="token keyword">for</span> <span class="token number">6</span> <span class="token timeframe">quarters</span></code> respectively. These ranges can be used in filters just like time literals.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: dep_time: <span class="token date">@2003</span> <span class="token keyword">to</span> <span class="token date">@2005</span> } <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13,621,381</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">13621381</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>base<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2003-01-01'</span><span class="token punctuation">)</span><span class="token operator">and</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>dep_time<span class="token operator">&lt;</span><span class="token string">'2005-01-01'</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>Time literals and truncations can also behave like time ranges. Each kind of time literal has an implied duration that takes effect when it is used in a comparison, e.g. <code class="language-malloy"><span class="token date">@2003</span></code> represents the whole of the year 2003, and <code class="language-malloy"><span class="token date">@2004-Q1</span></code> lasts the whole 3 months of the quarter. Similarly, when a time value is truncated, it takes on the
timeframe from the truncation, e.g. <code class="language-malloy">now<span class="token punctuation">.</span><span class="token timeframe">month</span></code> means the entirety of the current month.</p>
<p>When a time range is used in a comparison, <code class="language-malloy"><span class="token operator">=</span></code> checks for "is in the range", <code class="language-malloy"><span class="token operator">></span></code> "is after", and <code class="language-malloy"><span class="token operator">&lt;</span></code> "is before." So <code class="language-malloy">some_time <span class="token operator">></span> <span class="token date">@2003</span></code> filters dates starting on January 1, 2004, while <code class="language-malloy">some_time <span class="token operator">=</span> <span class="token date">@2003</span></code> filters to dates in the year 2003.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> { <span class="token keyword">where</span>: dep_time <span class="token operator">></span> <span class="token date">@2003</span> } <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">top</span>: <span class="token number">3</span><span class="token punctuation">;</span> <span class="token keyword">order_by</span>: departure_date <span class="token keyword">asc</span>
  <span class="token keyword">group_by</span>: departure_date <span class="token keyword">is</span> dep_time<span class="token punctuation">.</span><span class="token timeframe">day</span>
  <span class="token keyword">aggregate</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">departure_&#8203;date</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2004-01-01</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">17,206</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2004-01-02</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">19,053</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">2004-01-03</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">17,252</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"departure_date"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-01"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">17206</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"departure_date"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-02"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">19053</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"departure_date"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2004-01-03"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">17252</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   DATE_TRUNC<span class="token punctuation">(</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>dep_time<span class="token punctuation">,</span> <span class="token string">'UTC'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span> <span class="token keyword">as</span> departure_date<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token keyword">WHERE</span> base<span class="token punctuation">.</span>dep_time<span class="token operator">>=</span><span class="token string">'2004-01-01'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">asc</span>
<span class="token keyword">LIMIT</span> <span class="token number">3</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="nested-queries" class="header-link anchor" href="#nested-queries">
          Nested Queries
        </a>
      </h2>
    <p>The next several examples will use this simple explore definition:</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: airports <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> {
  airport_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
}<span class="token punctuation">;</span></pre>
      <h3>
        <a id="aggregating-subqueries" class="header-link anchor" href="#aggregating-subqueries">
          Aggregating Subqueries
        </a>
      </h3>
    <p>In Malloy, queries can be <a href="nesting.html">nested</a> to produce subtables on each output row. Such nested queries are called <em>aggregating subqueries</em>, or simply "nested queries." When a query is nested inside another query, each output row of the outer query will have a nested table for the inner query which only includes data limited to that row.</p>
<pre class="language-malloy">
<span class="token keyword">query</span>: airports <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: airport_count
  <span class="token keyword">nest</span>: by_facility <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: fac_type
    <span class="token keyword">aggregate</span>: airport_count
  }
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;facility</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,845</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,389</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">435</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">569</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">396</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">IL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">890</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">625</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">245</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BALLOONPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">856</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">511</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">280</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">43</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">804</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">468</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">307</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1845</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1389</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">435</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">5</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">984</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">569</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">396</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"IL"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">890</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">625</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">245</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"BALLOONPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"FL"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">856</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">511</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">280</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">43</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">13</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">5</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"PA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">804</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">468</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">307</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">13</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    airports<span class="token punctuation">.</span>state <span class="token keyword">as</span> state__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> airports<span class="token punctuation">.</span>fac_type <span class="token keyword">END</span> <span class="token keyword">as</span> fac_type__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> airports
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
  state__0 <span class="token keyword">as</span> state<span class="token punctuation">,</span>
  ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> airport_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>fac_type__1 <span class="token keyword">as</span> fac_type<span class="token punctuation">,</span> airport_count__1 <span class="token keyword">as</span> airport_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  airport_count__1 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> by_facility
<span class="token keyword">FROM</span> __stage0
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>Here we can see that the <code class="language-malloy">by_facility</code> column of the output table contains nested subtables on each row. When interpreting these inner tables, all of the dimensional values from outer rows still apply to each of the inner rows.</p>
<p>Queries can be nested infinitely, allowing for rich, complex output structures. A query may always include another nested query, regardless of depth.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: airports <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: airport_count
  <span class="token keyword">nest</span>: top_5_counties <span class="token keyword">is</span> {
    <span class="token keyword">top</span>: <span class="token number">5</span>
    <span class="token keyword">group_by</span>: county
    <span class="token keyword">aggregate</span>: airport_count
    <span class="token keyword">nest</span>: by_facility <span class="token keyword">is</span> {
      <span class="token keyword">group_by</span>: fac_type
      <span class="token keyword">aggregate</span>: airport_count
    }
  }
}</pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">top_&#8203;5_&#8203;counties</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1,845</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;facility</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HARRIS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">135</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">110</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">25</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TARRANT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">63</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">35</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">26</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DENTON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">47</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DALLAS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">42</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">32</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BEXAR</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">40</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">24</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">16</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;facility</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">151</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">23</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">47</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">24</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORANGE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">47</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">KERN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">49</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">41</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN DIEGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">49</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">30</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">17</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">IL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">890</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;facility</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">COOK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">51</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">44</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LA SALLE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">39</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">35</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MC HENRY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">29</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">20</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DE KALB</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">27</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">24</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WINNEBAGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">24</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">856</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;facility</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PALM BEACH</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">45</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">30</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">14</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DADE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">44</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">27</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">POLK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">43</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">18</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">16</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MARION</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">37</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">27</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORANGE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">36</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">24</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">804</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;facility</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BUCKS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">55</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">32</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">19</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STOLPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MONTGOMERY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">44</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">29</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">14</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ALLEGHENY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">31</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">22</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CHESTER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">27</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">16</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PHILADELPHIA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">26</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">22</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1845</span><span class="token punctuation">,</span>
    <span class="token property">"top_5_counties"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"HARRIS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">135</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">110</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">25</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TARRANT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">63</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">35</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">26</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"DENTON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">47</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"DALLAS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">32</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"BEXAR"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">24</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">16</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">984</span><span class="token punctuation">,</span>
    <span class="token property">"top_5_counties"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">176</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">151</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">23</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">71</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">47</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">24</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ORANGE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">47</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"KERN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">41</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN DIEGO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">30</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">17</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"IL"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">890</span><span class="token punctuation">,</span>
    <span class="token property">"top_5_counties"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"COOK"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">51</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">44</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LA SALLE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">35</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MC HENRY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">20</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"DE KALB"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">24</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">3</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"WINNEBAGO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">15</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"FL"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">856</span><span class="token punctuation">,</span>
    <span class="token property">"top_5_counties"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"PALM BEACH"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">30</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">14</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"DADE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">27</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"POLK"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">43</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">18</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">16</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MARION"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">27</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ORANGE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">24</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"PA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">804</span><span class="token punctuation">,</span>
    <span class="token property">"top_5_counties"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"BUCKS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">32</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">19</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"STOLPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MONTGOMERY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">29</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">14</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ALLEGHENY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">22</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CHESTER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">16</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">11</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"PHILADELPHIA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
        <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">22</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
            <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    airports<span class="token punctuation">.</span>state <span class="token keyword">as</span> state__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> airports<span class="token punctuation">.</span>county <span class="token keyword">END</span> <span class="token keyword">as</span> county__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> airports<span class="token punctuation">.</span>fac_type <span class="token keyword">END</span> <span class="token keyword">as</span> fac_type__2<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__2
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> airports
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span>
<span class="token punctuation">)</span>
<span class="token punctuation">,</span> __stage1 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> 
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token number">1</span>  <span class="token keyword">ELSE</span> group_set <span class="token keyword">END</span> <span class="token keyword">as</span> group_set<span class="token punctuation">,</span>
    state__0 <span class="token keyword">as</span> state__0<span class="token punctuation">,</span>
    ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> airport_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> county__1 <span class="token keyword">END</span> <span class="token keyword">as</span> county__1<span class="token punctuation">,</span>
    ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> airport_count__1 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count__1<span class="token punctuation">,</span>
    ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>fac_type__2 <span class="token keyword">as</span> fac_type<span class="token punctuation">,</span> airport_count__2 <span class="token keyword">as</span> airport_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  airport_count__2 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> by_facility__1
  <span class="token keyword">FROM</span> __stage0
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
  state__0 <span class="token keyword">as</span> state<span class="token punctuation">,</span>
  ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> airport_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>county__1 <span class="token keyword">as</span> county<span class="token punctuation">,</span> airport_count__1 <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span> by_facility__1 <span class="token keyword">as</span> by_facility<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  airport_count__1 <span class="token keyword">desc</span>  <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">as</span> top_5_counties
<span class="token keyword">FROM</span> __stage1
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="filtering-nested-queries" class="header-link anchor" href="#filtering-nested-queries">
          Filtering Nested Queries
        </a>
      </h3>
    <p>Filters can be isolated to any level of nesting. In the following example, we limit the <code class="language-malloy">major_facilities</code> query to only airports where <code class="language-malloy">major</code> is <code class="language-malloy"><span class="token string">'Y'</span></code>. This particular filter applies <em>only</em> to <code class="language-malloy">major_facilities</code>, and not to other parts of the outer query.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: airports <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">where</span>: state <span class="token operator">=</span> <span class="token string">'CA'</span>
  <span class="token keyword">group_by</span>: county
  <span class="token keyword">aggregate</span>: airport_count
  <span class="token keyword">nest</span>: major_facilities <span class="token keyword">is</span> {
    <span class="token keyword">where</span>: major <span class="token operator">=</span> <span class="token string">'Y'</span>
    <span class="token keyword">group_by</span>: name <span class="token keyword">is</span> <span class="token function">concat</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">' ('</span><span class="token punctuation">,</span> full_name<span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span>
  }
  <span class="token keyword">nest</span>: by_facility <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: fac_type
    <span class="token keyword">aggregate</span>: airport_count
  }
}</pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">major_&#8203;facilities</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;facility</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">name</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BUR (BURBANK-GLENDALE-PASADENA)</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LAX (LOS ANGELES INTL)</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LGB (LONG BEACH /DAUGHERTY FIELD/)</td>
</tr>

		</tbody>
	</table></td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">151</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">23</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SEAPLANE BASE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">name</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ONT (ONTARIO INTL)</td>
</tr>

		</tbody>
	</table></td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">47</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">24</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORANGE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">name</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SNA (JOHN WAYNE AIRPORT-ORANGE COUNTY)</td>
</tr>

		</tbody>
	</table></td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">47</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN DIEGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">49</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">name</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN (SAN DIEGO INTL-LINDBERGH FLD)</td>
</tr>

		</tbody>
	</table></td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">30</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">17</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLIDERPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">KERN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">49</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">name</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BFL (MEADOWS FIELD)</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">IYK (INYOKERN)</td>
</tr>

		</tbody>
	</table></td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">fac_&#8203;type</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AIRPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">41</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HELIPORT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULTRALIGHT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">176</span><span class="token punctuation">,</span>
    <span class="token property">"major_facilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"BUR (BURBANK-GLENDALE-PASADENA)"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"LAX (LOS ANGELES INTL)"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"LGB (LONG BEACH /DAUGHERTY FIELD/)"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">151</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">23</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"SEAPLANE BASE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">71</span><span class="token punctuation">,</span>
    <span class="token property">"major_facilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ONT (ONTARIO INTL)"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">47</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">24</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ORANGE"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
    <span class="token property">"major_facilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"SNA (JOHN WAYNE AIRPORT-ORANGE COUNTY)"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">47</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN DIEGO"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
    <span class="token property">"major_facilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"SAN (SAN DIEGO INTL-LINDBERGH FLD)"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">30</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">17</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"GLIDERPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"KERN"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
    <span class="token property">"major_facilities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"BFL (MEADOWS FIELD)"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"IYK (INYOKERN)"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"by_facility"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"AIRPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">41</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"HELIPORT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"fac_type"</span><span class="token operator">:</span> <span class="token string">"ULTRALIGHT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    airports<span class="token punctuation">.</span>county <span class="token keyword">as</span> county__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> concat<span class="token punctuation">(</span>airports<span class="token punctuation">.</span>code<span class="token punctuation">,</span><span class="token string">' ('</span><span class="token punctuation">,</span>airports<span class="token punctuation">.</span>full_name<span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> name__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> airports<span class="token punctuation">.</span>fac_type <span class="token keyword">END</span> <span class="token keyword">as</span> fac_type__2<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__2
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> airports
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>airports<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'CA'</span><span class="token punctuation">)</span>
  <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>group_set <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>group_set <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">AND</span> airports<span class="token punctuation">.</span>major<span class="token operator">=</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
  county__0 <span class="token keyword">as</span> county<span class="token punctuation">,</span>
  ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> airport_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>name__1 <span class="token keyword">as</span> name<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  name__1 <span class="token keyword">asc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> major_facilities<span class="token punctuation">,</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>fac_type__2 <span class="token keyword">as</span> fac_type<span class="token punctuation">,</span> airport_count__2 <span class="token keyword">as</span> airport_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  airport_count__2 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> by_facility
<span class="token keyword">FROM</span> __stage0
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="piping-and-multi-stage-queries" class="header-link anchor" href="#piping-and-multi-stage-queries">
          Piping and Multi-stage Queries
        </a>
      </h2>
    <p>The output from one stage of a query can be "piped" into another stage using <code class="language-malloy"><span class="token operator">|</span></code>. For example, we'll start with this query which outputs, for California and New York, the total number of airports, as well as the number of airports in each county.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: airports <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">where</span>: state <span class="token operator">=</span> <span class="token string">'CA'</span> <span class="token operator">|</span> <span class="token string">'NY'</span>
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: airport_count
  <span class="token keyword">nest</span>: by_county <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: county
    <span class="token keyword">aggregate</span>: airport_count
  }
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">by_&#8203;county</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORANGE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN DIEGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">49</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">KERN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">49</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">RIVERSIDE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">46</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FRESNO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">40</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SACRAMENTO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">24</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA BARBARA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">22</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN JOAQUIN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">20</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">VENTURA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">19</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SUTTER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">16</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TULARE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">16</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">EL DORADO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MERCED</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">KINGS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ALAMEDA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">14</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN LUIS OBISPO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">14</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MONTEREY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SISKIYOU</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SONOMA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MADERA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">IMPERIAL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BUTTE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MODOC</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SHASTA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CLARA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STANISLAUS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NEVADA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">COLUSA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">INYO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HUMBOLDT</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">YOLO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CONTRA COSTA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TEHAMA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NAPA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MENDOCINO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LAKE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SANTA CRUZ</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SOLANO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PLUMAS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PLACER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TRINITY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TUOLUMNE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">AMADOR</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LASSEN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MONO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MARIN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">YUBA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CALAVERAS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN MATEO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BENITO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GLENN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DEL NORTE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MARIPOSA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN FRANCISCO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">3</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SIERRA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ALPINE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ESMERALDA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">576</td>
<td style="padding: 0; vertical-align: top; border-bottom: 1px solid #eaeaea; "><table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airport_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SUFFOLK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">34</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ERIE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">26</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NIAGARA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">20</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DUTCHESS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">20</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ONONDAGA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">18</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ONEIDA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">18</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ULSTER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">17</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORANGE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">16</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ONTARIO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NASSAU</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">15</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CHAUTAUQUA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">14</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MONROE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">DELAWARE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ALBANY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">13</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OSWEGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SARATOGA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MONTGOMERY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">12</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WESTCHESTER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">QUEENS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CATTARAUGUS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">11</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WAYNE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ESSEX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SULLIVAN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">10</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">STEUBEN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SCHOHARIE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">JEFFERSON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORLEANS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WYOMING</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">9</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GREENE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CLINTON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LIVINGSTON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CAYUGA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ST LAWRENCE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">COLUMBIA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FULTON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CHEMUNG</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HERKIMER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SCHENECTADY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TOMPKINS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">NEW YORK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SCHUYLER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">HAMILTON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BROOME</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">RENSSELAER</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">MADISON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">OTSEGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GENESEE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">6</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CHENANGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WASHINGTON</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SENECA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TIOGA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">WARREN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ALLEGANY</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">YATES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ROCKLAND</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CORTLAND</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FRANKLIN</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">PUTNAM</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">BRONX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LEWIS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">KINGS</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">1</td>
</tr>

		</tbody>
	</table></td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">984</span><span class="token punctuation">,</span>
    <span class="token property">"by_county"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">176</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">71</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ORANGE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">53</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN DIEGO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">49</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"KERN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">49</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"RIVERSIDE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">46</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"FRESNO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">40</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SACRAMENTO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">24</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA BARBARA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">22</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN JOAQUIN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">20</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"VENTURA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">19</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SUTTER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">16</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TULARE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">16</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"EL DORADO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">15</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MERCED"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">15</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"KINGS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">15</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ALAMEDA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">14</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN LUIS OBISPO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">14</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MONTEREY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">13</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SISKIYOU"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">13</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SONOMA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MADERA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"IMPERIAL"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"BUTTE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">11</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MODOC"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">11</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SHASTA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">11</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA CLARA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"STANISLAUS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"NEVADA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"COLUSA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"INYO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"HUMBOLDT"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"YOLO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CONTRA COSTA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TEHAMA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"NAPA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MENDOCINO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LAKE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SANTA CRUZ"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SOLANO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"PLUMAS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"PLACER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TRINITY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TUOLUMNE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"AMADOR"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LASSEN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MONO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MARIN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"YUBA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">5</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CALAVERAS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">5</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN MATEO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN BENITO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"GLENN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"DEL NORTE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MARIPOSA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN FRANCISCO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SIERRA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ALPINE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ESMERALDA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"state"</span><span class="token operator">:</span> <span class="token string">"NY"</span><span class="token punctuation">,</span>
    <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">576</span><span class="token punctuation">,</span>
    <span class="token property">"by_county"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SUFFOLK"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">34</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ERIE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">26</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"NIAGARA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">20</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"DUTCHESS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">20</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ONONDAGA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">18</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ONEIDA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">18</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ULSTER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">17</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ORANGE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">16</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ONTARIO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">15</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"NASSAU"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">15</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CHAUTAUQUA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">14</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MONROE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">13</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"DELAWARE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">13</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ALBANY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">13</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"OSWEGO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SARATOGA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MONTGOMERY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">12</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"WESTCHESTER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">11</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"QUEENS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">11</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CATTARAUGUS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">11</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"WAYNE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ESSEX"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SULLIVAN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"STEUBEN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SCHOHARIE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"JEFFERSON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ORLEANS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"WYOMING"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">9</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"GREENE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CLINTON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LIVINGSTON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CAYUGA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ST LAWRENCE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"COLUMBIA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"FULTON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CHEMUNG"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"HERKIMER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SCHENECTADY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TOMPKINS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"NEW YORK"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SCHUYLER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"HAMILTON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"BROOME"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"RENSSELAER"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"MADISON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"OTSEGO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"GENESEE"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CHENANGO"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">5</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"WASHINGTON"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SENECA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"TIOGA"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"WARREN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ALLEGANY"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"YATES"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ROCKLAND"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"CORTLAND"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"FRANKLIN"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"PUTNAM"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"BRONX"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LEWIS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"KINGS"</span><span class="token punctuation">,</span>
        <span class="token property">"airport_count"</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    airports<span class="token punctuation">.</span>state <span class="token keyword">as</span> state__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> airports<span class="token punctuation">.</span>county <span class="token keyword">END</span> <span class="token keyword">as</span> county__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> airports
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>airports<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'CA'</span><span class="token punctuation">)</span><span class="token operator">or</span><span class="token punctuation">(</span>airports<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'NY'</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span>
  state__0 <span class="token keyword">as</span> state<span class="token punctuation">,</span>
  ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> airport_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
  ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>county__1 <span class="token keyword">as</span> county<span class="token punctuation">,</span> airport_count__1 <span class="token keyword">as</span> airport_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  airport_count__1 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> by_county
<span class="token keyword">FROM</span> __stage0
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>Next, we'll use the output of that query as the input to another, where we determine which counties have the highest
percentage of airports compared to the whole state, taking advantage of the nested structure of the data to to so.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: airports <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">where</span>: state <span class="token operator">=</span> <span class="token string">'CA'</span> <span class="token operator">|</span> <span class="token string">'NY'</span>
  <span class="token keyword">group_by</span>: state
  <span class="token keyword">aggregate</span>: airport_count
  <span class="token keyword">nest</span>: by_county <span class="token keyword">is</span> {
    <span class="token keyword">group_by</span>: county
    <span class="token keyword">aggregate</span>: airport_count
  }
} <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">top</span>: <span class="token number">10</span><span class="token punctuation">;</span> <span class="token keyword">order_by</span>: <span class="token number">4</span> <span class="token keyword">desc</span>
  <span class="token keyword">project</span>: <span class="token punctuation">[</span>
    by_county<span class="token punctuation">.</span>county
    airports_in_county <span class="token keyword">is</span> by_county<span class="token punctuation">.</span>airport_count
    airports_in_state <span class="token keyword">is</span> airport_count
    percent_in_county <span class="token keyword">is</span> by_county<span class="token punctuation">.</span>airport_count <span class="token operator">/</span> airport_count
  <span class="token punctuation">]</span>
}</pre><div class="result-outer large">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airports_&#8203;in_&#8203;county</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">airports_&#8203;in_&#8203;state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">percent_&#8203;in_&#8203;county</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">LOS ANGELES</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">176</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">17.89%</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN BERNARDINO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">71</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">7.22%</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SUFFOLK</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">34</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">576</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5.9%</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">ORANGE</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">53</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5.39%</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">SAN DIEGO</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">49</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">984</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4.98%</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"LOS ANGELES"</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_county"</span><span class="token operator">:</span> <span class="token number">176</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_state"</span><span class="token operator">:</span> <span class="token number">984</span><span class="token punctuation">,</span>
    <span class="token property">"percent_in_county"</span><span class="token operator">:</span> <span class="token number">0.17886178861788618</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN BERNARDINO"</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_county"</span><span class="token operator">:</span> <span class="token number">71</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_state"</span><span class="token operator">:</span> <span class="token number">984</span><span class="token punctuation">,</span>
    <span class="token property">"percent_in_county"</span><span class="token operator">:</span> <span class="token number">0.07215447154471545</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SUFFOLK"</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_county"</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_state"</span><span class="token operator">:</span> <span class="token number">576</span><span class="token punctuation">,</span>
    <span class="token property">"percent_in_county"</span><span class="token operator">:</span> <span class="token number">0.059027777777777776</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"ORANGE"</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_county"</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_state"</span><span class="token operator">:</span> <span class="token number">984</span><span class="token punctuation">,</span>
    <span class="token property">"percent_in_county"</span><span class="token operator">:</span> <span class="token number">0.05386178861788618</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"county"</span><span class="token operator">:</span> <span class="token string">"SAN DIEGO"</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_county"</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
    <span class="token property">"airports_in_state"</span><span class="token operator">:</span> <span class="token number">984</span><span class="token punctuation">,</span>
    <span class="token property">"percent_in_county"</span><span class="token operator">:</span> <span class="token number">0.049796747967479675</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">WITH</span> __stage0 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    group_set<span class="token punctuation">,</span>
    airports<span class="token punctuation">.</span>state <span class="token keyword">as</span> state__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__0<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> airports<span class="token punctuation">.</span>county <span class="token keyword">END</span> <span class="token keyword">as</span> county__1<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">as</span> airport_count__1
  <span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">as</span> airports
  <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>  group_set <span class="token keyword">FROM</span> UNNEST<span class="token punctuation">(</span>GENERATE_ARRAY<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>airports<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'CA'</span><span class="token punctuation">)</span><span class="token operator">or</span><span class="token punctuation">(</span>airports<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'NY'</span><span class="token punctuation">)</span>
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span>
<span class="token punctuation">)</span>
<span class="token punctuation">,</span> __stage1 <span class="token keyword">AS</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span>
    state__0 <span class="token keyword">as</span> state<span class="token punctuation">,</span>
    ANY_VALUE<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">THEN</span> airport_count__0 <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> airport_count<span class="token punctuation">,</span>
    ARRAY_AGG<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> group_set<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">THEN</span> STRUCT<span class="token punctuation">(</span>county__1 <span class="token keyword">as</span> county<span class="token punctuation">,</span> airport_count__1 <span class="token keyword">as</span> airport_count<span class="token punctuation">)</span> <span class="token keyword">END</span> <span class="token keyword">IGNORE</span> NULLS  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  airport_count__1 <span class="token keyword">desc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> by_county
  <span class="token keyword">FROM</span> __stage0
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> 
   by_county_0<span class="token punctuation">.</span>county <span class="token keyword">as</span> county<span class="token punctuation">,</span>
   by_county_0<span class="token punctuation">.</span>airport_count <span class="token keyword">as</span> airports_in_county<span class="token punctuation">,</span>
   base<span class="token punctuation">.</span>airport_count <span class="token keyword">as</span> airports_in_state<span class="token punctuation">,</span>
   by_county_0<span class="token punctuation">.</span>airport_count<span class="token operator">/</span>base<span class="token punctuation">.</span>airport_count <span class="token keyword">as</span> percent_in_county
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>__stage1<span class="token punctuation">`</span> <span class="token keyword">as</span> base
<span class="token punctuation">,</span> UNNEST<span class="token punctuation">(</span>base<span class="token punctuation">.</span>by_county<span class="token punctuation">)</span> <span class="token keyword">as</span> by_county_0
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">4</span> <span class="token keyword">desc</span>
<span class="token keyword">LIMIT</span> <span class="token number">10</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="joins" class="header-link anchor" href="#joins">
          Joins
        </a>
      </h2>
    <p>Joins are declared as part of an explore, and link primary and foreign keys.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: airports <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.airports'</span><span class="token punctuation">)</span> {
  <span class="token keyword">primary_key</span>: code
}

<span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span> {
  <span class="token keyword">measure</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">join_one</span>: origin_airport <span class="token keyword">is</span> airports <span class="token keyword">with</span> origin
}

<span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: origin_state <span class="token keyword">is</span> origin_airport<span class="token punctuation">.</span>state
  <span class="token keyword">aggregate</span>: flight_count
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: left;">origin_&#8203;state</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">flight_&#8203;count</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">CA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,501,447</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">TX</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">4,368,374</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">IL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,516,461</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">FL</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,354,901</td>
</tr>
<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; ">GA</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">2,055,560</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"origin_state"</span><span class="token operator">:</span> <span class="token string">"CA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4501447</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"origin_state"</span><span class="token operator">:</span> <span class="token string">"TX"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">4368374</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"origin_state"</span><span class="token operator">:</span> <span class="token string">"IL"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2516461</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"origin_state"</span><span class="token operator">:</span> <span class="token string">"FL"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2354901</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"origin_state"</span><span class="token operator">:</span> <span class="token string">"GA"</span><span class="token punctuation">,</span>
    <span class="token property">"flight_count"</span><span class="token operator">:</span> <span class="token number">2055560</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   origin_airport_0<span class="token punctuation">.</span>state <span class="token keyword">as</span> origin_state<span class="token punctuation">,</span>
   <span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> flight_count
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>flights<span class="token punctuation">`</span> <span class="token keyword">as</span> flights
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>airports<span class="token punctuation">`</span> <span class="token keyword">AS</span> origin_airport_0 <span class="token keyword">ON</span> flights<span class="token punctuation">.</span>origin <span class="token operator">=</span> origin_airport_0<span class="token punctuation">.</span>code
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div><p>In this example, the <code class="language-malloy">airports</code> explore is joined to <code class="language-malloy">flights</code>, linking the foreign key <code class="language-malloy">origin</code> of <code class="language-malloy">flights</code> to the primary key <code class="language-malloy">code</code> of <code class="language-malloy">airports</code>. The resulting joined explore is aliased as <code class="language-malloy">origin_airport</code> within <code class="language-malloy">flights</code>.</p>

      <h2>
        <a id="aggregate-calculations" class="header-link anchor" href="#aggregate-calculations">
          Aggregate Calculations
        </a>
      </h2>
    <p>As in SQL, aggregate functions <code class="language-malloy">sum</code>, <code class="language-malloy">count</code>, and <code class="language-malloy">avg</code> are available, and their use in
an expression identifies the corresponding field as a <a href="fields.html#measures">measure</a>.</p>
<p>Aggregates may be computed with respect to any joined explore, allowing for a wider variety of measurements to be calculated than is possible in SQL. See the <a href="aggregates.html#aggregate-locality">Aggregate Locality</a> section for more information.</p>
<pre class="language-malloy"><span class="token keyword">query</span>: aircraft <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    <span class="token comment">// The average number of seats on models of registered aircraft</span>
    models_avg_seats <span class="token keyword">is</span> aircraft_models<span class="token punctuation">.</span>seats<span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// The average number of seats on registered aircraft</span>
    aircraft_avg_seats <span class="token keyword">is</span> <span class="token function">avg</span><span class="token punctuation">(</span>aircraft_models<span class="token punctuation">.</span>seats<span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control"  data-result-kind="html">HTML</button>
        <button class="result-control" selected data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" >
      <div class="result-inner">
        <table style="border: 1px solid #eaeaea; vertical-align: top; border-bottom: 1px solid #eaeaea; border-collapse: collapse; width: 100%;">
		<thead>
			<tr>
				<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">models_&#8203;avg_&#8203;seats</th>
<th style="padding: 8px; color: #505050; border-bottom: 1px solid #eaeaea; text-align: right;">aircraft_&#8203;avg_&#8203;seats</th>
      </tr>
		</thead>
		<tbody>
			<tr><td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">5.145</td>
<td style="padding: 8px; vertical-align: top; border-bottom: 1px solid #eaeaea; text-align: right;">8.373</td>
</tr>

		</tbody>
	</table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" selected>
      <div class="result-inner">
        <pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"models_avg_seats"</span><span class="token operator">:</span> <span class="token number">5.145145145145145</span><span class="token punctuation">,</span>
    <span class="token property">"aircraft_avg_seats"</span><span class="token operator">:</span> <span class="token number">8.372722397134547</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><span class="token keyword">SELECT</span> 
   CAST<span class="token punctuation">(</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>
      <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span>
        <span class="token punctuation">(</span>CAST<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token keyword">COALESCE</span><span class="token punctuation">(</span>aircraft_models_0<span class="token punctuation">.</span>seats<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token punctuation">(</span>cast<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> substr<span class="token punctuation">(</span>to_hex<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>CAST<span class="token punctuation">(</span>aircraft_models_0<span class="token punctuation">.</span>aircraft_model_code <span class="token keyword">AS</span> STRING<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> int64<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">numeric</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4294967296</span> <span class="token operator">+</span> cast<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> substr<span class="token punctuation">(</span>to_hex<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>CAST<span class="token punctuation">(</span>aircraft_models_0<span class="token punctuation">.</span>aircraft_model_code <span class="token keyword">AS</span> STRING<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> int64<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">numeric</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.000000001</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token operator">-</span>
       <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token punctuation">(</span>cast<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> substr<span class="token punctuation">(</span>to_hex<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>CAST<span class="token punctuation">(</span>aircraft_models_0<span class="token punctuation">.</span>aircraft_model_code <span class="token keyword">AS</span> STRING<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> int64<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">numeric</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4294967296</span> <span class="token operator">+</span> cast<span class="token punctuation">(</span>cast<span class="token punctuation">(</span>concat<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> substr<span class="token punctuation">(</span>to_hex<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>CAST<span class="token punctuation">(</span>aircraft_models_0<span class="token punctuation">.</span>aircraft_model_code <span class="token keyword">AS</span> STRING<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> int64<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">numeric</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.000000001</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> FLOAT64<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">NULLIF</span><span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> aircraft_models_0<span class="token punctuation">.</span>aircraft_model_code<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> models_avg_seats<span class="token punctuation">,</span>
   <span class="token function">AVG</span><span class="token punctuation">(</span>aircraft_models_0<span class="token punctuation">.</span>seats<span class="token punctuation">)</span> <span class="token keyword">as</span> aircraft_avg_seats
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>aircraft<span class="token punctuation">`</span> <span class="token keyword">as</span> aircraft
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>malloy<span class="token operator">-</span><span class="token keyword">data</span><span class="token punctuation">.</span>faa<span class="token punctuation">.</span>aircraft_models<span class="token punctuation">`</span> <span class="token keyword">AS</span> aircraft_models_0 <span class="token keyword">ON</span> aircraft<span class="token punctuation">.</span>aircraft_model_code <span class="token operator">=</span> aircraft_models_0<span class="token punctuation">.</span>aircraft_model_code
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span> <span class="token keyword">desc</span>
</pre>
      </div>
    </div>
  </div>
      <h2>
        <a id="comments" class="header-link anchor" href="#comments">
          Comments
        </a>
      </h2>
    <p>Malloy code can include both line and block comments. Line comments, which begin with <code class="language-malloy"><span class="token comment">--</span></code> or <code class="language-malloy"><span class="token comment">//</span></code>,
may appear anywhere within a line, and cause all subsequent characters on that line to be ignored.
Block comments, which are enclosed between <code>/*</code> and <code>*/</code>, cause all enclosed characters to be ignored
and may span multiple lines.</p>
<pre class="language-malloy"><span class="token comment">-- The total number of flight entries</span>
<span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">aggregate</span>: flight_count <span class="token comment">// Defined simply as `count()`</span>
}

<span class="token comment">/*
 * A comparison of the total number of flights
 * for each of the tracked carriers.
 */</span>
<span class="token keyword">query</span>: flights <span class="token operator">-</span><span class="token operator">></span> {
  <span class="token keyword">group_by</span>: carrier
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span> flight_count <span class="token comment">/* , total_distance */</span> <span class="token punctuation">]</span>
}</pre><!-- ## Joins are between primary and foreign keys.


## Full graph of the data is available to query

## Sums and Counts and average are a little different.

## Calculations can correctly occur anywhere in the graph --><!--

## Removed things
- Commas are optional.
- Count can be written without the `*`.

--></div>
          </div>
        </div>
        <script src="/malloy/js/view_toggles.js"></script>
      </div>
    </div>
  </body>
</html>