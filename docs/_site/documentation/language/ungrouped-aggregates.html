<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/malloy/img/favicon.ico"
    />
    <script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-0M10W7C20Y"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-0M10W7C20Y");
</script>

  </head>
  <body>
    <div class="top">
      <div class="header">
        <div class="header-banner">
          <img src="/malloy/img/logo.png" alt="malloy logo" />
          Malloy
          <span class="subtitle">Documentation</span>
        </div>
        <form onSubmit="() => alert('submit')" action="/malloy/search">
          <div class="search-input-outer">
            <img src="/malloy/img/search.svg" alt="search" />
            <input placeholder="Search" id="search-input" name="query" />
          </div>
          <input type="submit" style="display: none" />
        </form>
      </div>
      <div class="main">
        <div class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <div id=getting_started
        class="sidebar-section-title collapsed"
      >
        Getting Started
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/index.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        About Malloy
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/malloy_by_example.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Malloy By Example
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/basic.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Quickstart
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/features.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Key Features
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/samples.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Sample Models
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/connection_instructions.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Connecting a Database
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/tao.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        The Tao of Malloy
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=language_reference
        class="sidebar-section-title collapsed"
      >
        Language Reference
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/language/overview.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Introduction
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/sql_to_malloy.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        SQL to Malloy
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/statement.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Models
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/source.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Sources
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/query.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Queries
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/fields.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Fields
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/aggregates.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Aggregates
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/filters.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Filters
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/order_by.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Ordering and Limiting
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/join.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Joins
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/nesting.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Nested Queries
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/expressions.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Expressions
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/sql_blocks.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        SQL Blocks
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/imports.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Imports
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/types.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Types
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/language/changelog.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Change Log
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=rendering_results
        class="sidebar-section-title collapsed"
      >
        Rendering Results
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/dashboards.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Intro: Charts & Dashboards
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/bar_charts.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Bar Charts
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/charts_line_chart.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Line Charts
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/scatter_charts.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Scatter Charts
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/shape_maps.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Shape Maps
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/visualizations/segment_maps.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Segment Maps
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=common_patterns
        class="sidebar-section-title collapsed"
      >
        Common Patterns
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/yoy.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Year Over Year Analysis
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/foreign_sums.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Foreign Sums and Averages
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/percent_of_total.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Percent of Total
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/cohorts.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Cohort Analysis
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/pivot_limits.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Pivot Limits
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/patterns/sessionize.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Sessionized Data
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=examples
        class="sidebar-section-title collapsed"
      >
        Examples
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class="sidebar-section">
      <div id=ntsb_flight database
        class="sidebar-section-title collapsed"
      >
        NTSB Flight Database
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/examples/faa/bigquery.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        FAA Dashboards
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/faa/postgres.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Connect with Postgres
      </a>
    </div>
      </div>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/ecommerce.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        eCommerce Analysis
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/names.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        The Name Game
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/ga_sessions.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Google Analytics GA360
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=walkthrough:_iowa liquor
        class="sidebar-section-title collapsed"
      >
        Walkthrough: Iowa Liquor
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/iowa.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        About the Data Set
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/source.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        The Malloy Data Model
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step2.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Basic Calculations
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step2a.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Analysis: Products and Brands
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step3.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Bucketing and Mapping
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/iowa/step6.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Dashboards
      </a>
    </div>
      </div>
    </div>
<div class="sidebar-section">
      <div id=walkthrough:_wordle solver
        class="sidebar-section-title collapsed"
      >
        Walkthrough: Wordle Solver
        <img class="chevron-open" src="/malloy/img/section_open.svg" alt="section open"/>
        <img class="chevron-closed" src="/malloy/img/section_close.svg" alt="section closed"/>
      </div>
      <div class="sidebar-section-item-group">
        <div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Just Words
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle1a.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Letters and Positioning
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle2.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Letter Frequency
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle3.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Scoring Words
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle4.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Final Model
      </a>
    </div>
<div class='sidebar-item '>
      <a href="/malloy/documentation/examples/wordle/wordle5.html">
        <img src="/malloy/img/article_icon.svg" alt="document"/>
        Solving Puzzles
      </a>
    </div>
      </div>
    </div>
  </div>
        <script src="/malloy/js/sidebar_state.js"></script>
        <div class="content">
          <div class="footer">
             <div class="linear-navigation">
    <div class="item">
      
    </div>
    <div class="item">
      <a href="../index.html">About Malloy<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div> 
          </div>
          <div class="document-outer"><div class="document">
      <h1>
        <a id="ungrouped-aggregates" class="header-link anchor" href="#ungrouped-aggregates">
          Ungrouped Aggregates
        </a>
      </h1>
    <p>In a query which is grouped by multiple dimensions, it is often useful to be able to perform an aggregate calculation on sub-groups.</p>

      <h3>
        <a id="-strong-all-aggregateexpression-strong-" class="header-link anchor" href="#-strong-all-aggregateexpression-strong-">
          <strong>all(aggregateExpression)</strong>
        </a>
      </h3>
    <p>The <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">all</span><span style="color: #000000">()</span></span></code> function will perform the specified aggregate computation, ignoring the grouping in the
current_query to provide an overall value.</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">faa_region</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">: </span><span style="color: #001080">percent_of_total</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">() / </span><span style="color: #795E26">all</span><span style="color: #000000">(</span><span style="color: #795E26">count</span><span style="color: #000000">())*</span><span style="color: #098658">100.0</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="vertical-align: top; border-collapse: collapse; width: 100%;"><thead><tr><th style="padding: 8px; text-align: left;">faa_​region</th><th style="padding: 8px; text-align: right;">percent_​of_​total</th></tr></thead><tbody><tr><td style="padding: 8px; vertical-align: top;"><span>AGL</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>22.417</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>ASW</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>16.511</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>ASO</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>14.773</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>AEA</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>13.065</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>ANM</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>10.62</span></td></tr></tbody></table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AGL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_total&quot;</span><span style="color: #000000">: </span><span style="color: #098658">22.41701611680897</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_total&quot;</span><span style="color: #000000">: </span><span style="color: #098658">16.51088768756631</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_total&quot;</span><span style="color: #000000">: </span><span style="color: #098658">14.772899509927754</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AEA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_total&quot;</span><span style="color: #000000">: </span><span style="color: #098658">13.065225079573587</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;percent_of_total&quot;</span><span style="color: #000000">: </span><span style="color: #098658">10.619916131965846</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    __lateral_join_bag.faa_region__1,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">/</span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">OVER</span><span style="color: #000000"> ()*</span><span style="color: #098658">100</span><span style="color: #000000">.</span><span style="color: #098658">0</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> percent_of_total__1</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.airports`</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> airports</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">OVER</span><span style="color: #000000">() -</span><span style="color: #098658">1</span><span style="color: #000000">  group_set </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> UNNEST(GENERATE_ARRAY(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)))</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> UNNEST([STRUCT(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">    airports.faa_region</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> faa_region__1)]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> __lateral_join_bag</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  faa_region__1 </span><span style="color: #0000FF">as</span><span style="color: #000000"> faa_region,</span></span>
<span class="line"><span style="color: #000000">  ANY_VALUE(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> percent_of_total__1 </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> percent_of_total</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">0</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="-strong-all-aggregateexpression-groupingdimension-strong-" class="header-link anchor" href="#-strong-all-aggregateexpression-groupingdimension-strong-">
          <strong>all(aggregateExpression, groupingDimension, ...)</strong>
        </a>
      </h3>
    <p>When the optional grouping dimension argument is provided, <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">all</span><span style="color: #000000">()</span></span></code> will preserve grouping by the named dimensions (<code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">faa_region</span></span></code>), but will not group by un-named dimensions (<code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">state</span></span></code>).</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">faa_region</span><span style="color: #000000">, </span><span style="color: #001080">state</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">airports_in_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">airports_in_region</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">all</span><span style="color: #000000">(</span><span style="color: #795E26">count</span><span style="color: #000000">(), </span><span style="color: #001080">faa_region</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">order_by</span><span style="color: #000000">: </span><span style="color: #001080">airports_in_state</span><span style="color: #000000"> </span><span style="color: #AF00DB">desc</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="vertical-align: top; border-collapse: collapse; width: 100%;"><thead><tr><th style="padding: 8px; text-align: left;">faa_​region</th><th style="padding: 8px; text-align: left;">state</th><th style="padding: 8px; text-align: right;">airports_​in_​state</th><th style="padding: 8px; text-align: right;">airports_​in_​region</th></tr></thead><tbody><tr><td style="padding: 8px; vertical-align: top;"><span>ASW</span></td><td style="padding: 8px; vertical-align: top;"><span>TX</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>1,845</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>3,268</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>AWP</span></td><td style="padding: 8px; vertical-align: top;"><span>CA</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>984</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>1,503</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>AGL</span></td><td style="padding: 8px; vertical-align: top;"><span>IL</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>890</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>4,437</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>ASO</span></td><td style="padding: 8px; vertical-align: top;"><span>FL</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>856</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,924</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>AEA</span></td><td style="padding: 8px; vertical-align: top;"><span>PA</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>804</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,586</span></td></tr></tbody></table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;TX&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1845</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_region&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3268</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AWP&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;CA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">984</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_region&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1503</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AGL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;IL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">890</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_region&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4437</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;FL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">856</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_region&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2924</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AEA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;state&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;PA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_state&quot;</span><span style="color: #000000">: </span><span style="color: #098658">804</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;airports_in_region&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2586</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    __lateral_join_bag.faa_region__2,</span></span>
<span class="line"><span style="color: #000000">    __lateral_join_bag.state__2,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> airports_in_state__2,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">OVER</span><span style="color: #000000"> (</span><span style="color: #0000FF">PARTITION</span><span style="color: #000000"> </span><span style="color: #0000FF">BY</span><span style="color: #000000"> __lateral_join_bag.faa_region__2) </span><span style="color: #0000FF">as</span><span style="color: #000000"> airports_in_region__2</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.airports`</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> airports</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">OVER</span><span style="color: #000000">() -</span><span style="color: #098658">1</span><span style="color: #000000">  group_set </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> UNNEST(GENERATE_ARRAY(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)))</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> UNNEST([STRUCT(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">    airports.faa_region</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> faa_region__2,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">    airports.state</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> state__2)]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> __lateral_join_bag</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  faa_region__2 </span><span style="color: #0000FF">as</span><span style="color: #000000"> faa_region,</span></span>
<span class="line"><span style="color: #000000">  state__2 </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">state</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">  ANY_VALUE(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> airports_in_state__2 </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> airports_in_state,</span></span>
<span class="line"><span style="color: #000000">  ANY_VALUE(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> airports_in_region__2 </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> airports_in_region</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div><p>Dimensions named in <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">all</span><span style="color: #000000">()</span></span></code> must be included in a <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">group_by</span></span></code> in the current query.</p>

      <h3>
        <a id="-strong-exclude-aggregateexpression-groupingdimension-strong-" class="header-link anchor" href="#-strong-exclude-aggregateexpression-groupingdimension-strong-">
          <strong>exclude(aggregateExpression, groupingDimension)</strong>
        </a>
      </h3>
    <p>Similar to <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">al</span><span style="color: #000000">()</span></span></code>,  <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #795E26">exclude</span><span style="color: #000000">()</span></span></code> allows you to control which grouping dimensions are
used to compute <code class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #001080">aggregateExpression</span></span></code>. In this case, dimensions which should NOT be used are listed. For example, these two aggregates will do the exact same thing:</p>
<pre class="language-malloy" style="background-color: #FBFBFB"><span class="line"><span style="color: #AF00DB">query</span><span style="color: #000000">: </span><span style="color: #001080">airports</span><span style="color: #000000"> -&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">group_by</span><span style="color: #000000">: </span><span style="color: #001080">faa_region</span><span style="color: #000000">, </span><span style="color: #001080">fac_type</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">aggregate</span><span style="color: #000000">:</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">count_airports</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">count_in_region_exclude</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">exclude</span><span style="color: #000000">(</span><span style="color: #795E26">count</span><span style="color: #000000">(), </span><span style="color: #001080">fac_type</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">count_in_region_all</span><span style="color: #000000"> </span><span style="color: #AF00DB">is</span><span style="color: #000000"> </span><span style="color: #795E26">all</span><span style="color: #000000">(</span><span style="color: #795E26">count</span><span style="color: #000000">(), </span><span style="color: #001080">faa_region</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">}</span></span></pre><div class="result-outer small">
    <div class="result-controls-bar">
      <span class="result-label">QUERY RESULTS</span>
      <div class="result-controls">
        <button class="result-control" selected data-result-kind="html">HTML</button>
        <button class="result-control"  data-result-kind="json">JSON</button>
        <button class="result-control"  data-result-kind="sql">SQL</button>
      </div>
    </div>
    <div class="result-middle" data-result-kind="html" selected>
      <div class="result-inner">
        <table style="vertical-align: top; border-collapse: collapse; width: 100%;"><thead><tr><th style="padding: 8px; text-align: left;">faa_​region</th><th style="padding: 8px; text-align: left;">fac_​type</th><th style="padding: 8px; text-align: right;">count_​airports</th><th style="padding: 8px; text-align: right;">count_​in_​region_​exclude</th><th style="padding: 8px; text-align: right;">count_​in_​region_​all</th></tr></thead><tbody><tr><td style="padding: 8px; vertical-align: top;"><span>AGL</span></td><td style="padding: 8px; vertical-align: top;"><span>AIRPORT</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>3,443</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>4,437</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>4,437</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>ASW</span></td><td style="padding: 8px; vertical-align: top;"><span>AIRPORT</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,341</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>3,268</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>3,268</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>ASO</span></td><td style="padding: 8px; vertical-align: top;"><span>AIRPORT</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,038</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,924</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,924</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>AEA</span></td><td style="padding: 8px; vertical-align: top;"><span>AIRPORT</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>1,525</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,586</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,586</span></td></tr><tr><td style="padding: 8px; vertical-align: top;"><span>ANM</span></td><td style="padding: 8px; vertical-align: top;"><span>AIRPORT</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>1,524</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,102</span></td><td style="padding: 8px; vertical-align: top; text-align: right;"><span>2,102</span></td></tr></tbody></table>
      </div>
    </div>
    <div class="result-middle" data-result-kind="json" >
      <div class="result-inner">
        <pre><pre class="language-json" style="background-color: #FBFBFB"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AGL&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3443</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_exclude&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4437</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_all&quot;</span><span style="color: #000000">: </span><span style="color: #098658">4437</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASW&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2341</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_exclude&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3268</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_all&quot;</span><span style="color: #000000">: </span><span style="color: #098658">3268</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ASO&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2038</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_exclude&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2924</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_all&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2924</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AEA&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1525</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_exclude&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2586</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_all&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2586</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;faa_region&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;ANM&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;fac_type&quot;</span><span style="color: #000000">: </span><span style="color: #A31515">&quot;AIRPORT&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_airports&quot;</span><span style="color: #000000">: </span><span style="color: #098658">1524</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_exclude&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2102</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">&quot;count_in_region_all&quot;</span><span style="color: #000000">: </span><span style="color: #098658">2102</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">]</span></span></pre></pre>
      </div>
    </div>
    <div class="result-middle" data-result-kind="sql" >
      <div class="result-inner">
        <pre><pre class="language-sql" style="background-color: #FBFBFB"><span class="line"><span style="color: #0000FF">WITH</span><span style="color: #000000"> __stage0 </span><span style="color: #0000FF">AS</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">    group_set,</span></span>
<span class="line"><span style="color: #000000">    __lateral_join_bag.faa_region__3,</span></span>
<span class="line"><span style="color: #000000">    __lateral_join_bag.fac_type__3,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> count_airports__3,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">OVER</span><span style="color: #000000"> (</span><span style="color: #0000FF">PARTITION</span><span style="color: #000000"> </span><span style="color: #0000FF">BY</span><span style="color: #000000"> __lateral_join_bag.faa_region__3) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count_in_region_exclude__3,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">MAX</span><span style="color: #000000">(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #795E26">COUNT</span><span style="color: #000000">( </span><span style="color: #098658">1</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">OVER</span><span style="color: #000000"> (</span><span style="color: #0000FF">PARTITION</span><span style="color: #000000"> </span><span style="color: #0000FF">BY</span><span style="color: #000000"> __lateral_join_bag.faa_region__3) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count_in_region_all__3</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> </span><span style="color: #A31515">`malloy-data.faa.airports`</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> airports</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CROSS</span><span style="color: #000000"> </span><span style="color: #0000FF">JOIN</span><span style="color: #000000"> (</span><span style="color: #0000FF">SELECT</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">OVER</span><span style="color: #000000">() -</span><span style="color: #098658">1</span><span style="color: #000000">  group_set </span><span style="color: #0000FF">FROM</span><span style="color: #000000"> UNNEST(GENERATE_ARRAY(</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">3</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">)))</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">LEFT JOIN</span><span style="color: #000000"> UNNEST([STRUCT(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">3</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">) </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">    airports.faa_region</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> faa_region__3,</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span></span>
<span class="line"><span style="color: #000000">    airports.fac_type</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">END</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> fac_type__3)]) </span><span style="color: #0000FF">as</span><span style="color: #000000"> __lateral_join_bag</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">,</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">SELECT</span></span>
<span class="line"><span style="color: #000000">  faa_region__3 </span><span style="color: #0000FF">as</span><span style="color: #000000"> faa_region,</span></span>
<span class="line"><span style="color: #000000">  fac_type__3 </span><span style="color: #0000FF">as</span><span style="color: #000000"> fac_type,</span></span>
<span class="line"><span style="color: #000000">  ANY_VALUE(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> count_airports__3 </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count_airports,</span></span>
<span class="line"><span style="color: #000000">  ANY_VALUE(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> count_in_region_exclude__3 </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count_in_region_exclude,</span></span>
<span class="line"><span style="color: #000000">  ANY_VALUE(</span><span style="color: #0000FF">CASE</span><span style="color: #000000"> </span><span style="color: #0000FF">WHEN</span><span style="color: #000000"> group_set=</span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">THEN</span><span style="color: #000000"> count_in_region_all__3 </span><span style="color: #0000FF">END</span><span style="color: #000000">) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count_in_region_all</span></span>
<span class="line"><span style="color: #0000FF">FROM</span><span style="color: #000000"> __stage0</span></span>
<span class="line"><span style="color: #0000FF">WHERE</span><span style="color: #000000"> group_set </span><span style="color: #0000FF">NOT</span><span style="color: #000000"> </span><span style="color: #0000FF">IN</span><span style="color: #000000"> (</span><span style="color: #098658">0</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">GROUP BY</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #098658">2</span></span>
<span class="line"><span style="color: #0000FF">ORDER BY</span><span style="color: #000000"> </span><span style="color: #098658">3</span><span style="color: #000000"> </span><span style="color: #0000FF">desc</span></span>
<span class="line"></span></pre></pre>
      </div>
    </div>
  </div><p>The main difference is that in a nested query, it is legal to name a grouping dimension from an outer query which contains the inner query.</p>
</div></div>
        </div>
        <script src="/malloy/js/view_toggles.js"></script>
      </div>
    </div>
    <div id="banner_wrapper">
  <div id="banner">
    <div>
      This site uses cookies from Google to deliver its services and to analyze
      traffic.
      <a
        href="https://policies.google.com/technologies/cookies"
        target="_blank"
      >
        Learn more
      </a>
    </div>
    <button id="banner_button">I Understand</button>
  </div>
</div>

    <script src="/malloy/js/banner.js"></script>
  </body>
</html>
