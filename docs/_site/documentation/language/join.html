<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <img src="/malloy/img/logo.png" alt="malloy logo"/>Malloy <span class="subtitle">Documentation</span>
      </div>
      <div class="main">
        <div class="sidebar">
    <div>
        <div class="sidebar-section-title">Getting Started</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/index.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Tao of Malloy
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/features.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Key Features
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Language Reference</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/language/overview.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Introduction
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/basic.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Malloy Quickstart
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/statement.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Models
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/explore.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Explores
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/query.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Queries
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/fields.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Fields
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/types.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Types
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/expressions.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Expressions
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/order_by.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Ordering and Limiting
            </a>
          </div>
<div class='sidebar-item active'>
            <a href="/malloy/documentation/language/join.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Joins
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/filters.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Filters
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/nesting.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Nested Queries
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/aggregates.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Aggregates
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/imports.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Imports and Exports
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Common Patterns</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/yoy.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Year Over Year Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/foreign_sums.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Foreign Sums and Averages
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/percent_of_total.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Percent of Total
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/cohorts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Cohort Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/pivot_limits.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Pivot Limits
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/sessionize.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Sessionized Data
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Visualizations</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/bar_charts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Bar Charts
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/charts_line_chart.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Line Charts
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/shape_maps.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Shape Maps
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/segment_maps.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Segment Maps
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/scatter_charts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Scatter Charts
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Examples</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/examples/ecommerce.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              eCommerce Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/faa.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              NTSB Flight Database
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/names.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Name Game
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/ga_sessions.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Google Analytics GA360
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Iowa Liquor - An Analysis</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/iowa.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              About the Data Set
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/source.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Malloy Data Model
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step2.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Basic Calculations
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step2a.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Analysis: Products and Brands
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step3.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Bucketing and Mapping
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step6.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Dashboards
            </a>
          </div>
      </div>

  </div>
        <div class="content">
          <div class="footer">
            
            <div class="linear-navigation">
    <div class="item">
      <a href="order_by.html"><img src="/malloy/img/previous.svg" alt="previous"/>Ordering and Limiting</a>
    </div>
    <div class="item">
      <a href="filters.html">Filters<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div>
            
          </div>
          <div class="document-outer">
            <div class="document">
      <h1>
        <a id="joins" class="header-link anchor" href="#joins">
          Joins
        </a>
      </h1>
    <p>Currently, all joins in Malloy are left outer joins, and must be between the primary key of one table and a foreign key in the <a href="explore.html">explore</a> being joined to.</p>

      <h2>
        <a id="join-types" class="header-link anchor" href="#join-types">
          Join Types
        </a>
      </h2>
    
      <h3>
        <a id="foreign-key-to-primary-key" class="header-link anchor" href="#foreign-key-to-primary-key">
          Foreign Key to Primary Key
        </a>
      </h3>
    <p>To join a foreign key of the source explore to the <code class="language-malloy">primary <span class="token keyword">key</span></code> of a joined explore, reference the foreign key by name in the <code class="language-malloy"><span class="token keyword">on</span></code> clause.</p>
<pre class="language-malloy">order_items <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.ecomm.order_items'</span>
  order_items <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> user_id
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h3>
        <a id="primary-key-to-foreign-key" class="header-link anchor" href="#primary-key-to-foreign-key">
          Primary Key to Foreign Key
        </a>
      </h3>
    <p>To join the <code class="language-malloy">primary <span class="token keyword">key</span></code> of the source explore to a foreign key on a joined explore, reference the field from the joined explore in the <code class="language-malloy"><span class="token keyword">on</span></code> clause.</p>
<pre class="language-malloy">users <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.ecomm.users'</span>
  primary <span class="token keyword">key</span> id
  order_items <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> order_items<span class="token punctuation">.</span>user_id
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h2>
        <a id="naming-joined-explores" class="header-link anchor" href="#naming-joined-explores">
          Naming Joined Explores
        </a>
      </h2>
    <p>To preserve the name of the explore being joined in, use <code class="language-malloy"><span class="token keyword">join</span> <span class="token keyword">on</span></code>.</p>
<pre class="language-malloy">flights <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.flights'</span>
  primary <span class="token keyword">key</span> id2
  carriers <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> carrier
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>To give the joined explore a different name within the source explore, specify the name of the explore being joined in between <code class="language-malloy"><span class="token keyword">join</span></code> and <code class="language-malloy"><span class="token keyword">on</span></code>.</p>
<pre class="language-malloy">flights <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.flights'</span>
  primary <span class="token keyword">key</span> id2
  origin_airport <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> origin
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h2>
        <a id="inlining-joins" class="header-link anchor" href="#inlining-joins">
          Inlining Joins
        </a>
      </h2>
    <p>Explores do not need to be named before they are used in a join.</p>
<pre class="language-malloy">order_items <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.ecomm.order_items'</span>
  users <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token punctuation">(</span><span class="token string">'malloy-data.ecomm.users'</span>
    primary <span class="token keyword">key</span> id
  <span class="token punctuation">)</span> <span class="token keyword">on</span> user_id
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
      <h2>
        <a id="using-fields-in-joined-explores" class="header-link anchor" href="#using-fields-in-joined-explores">
          Using Fields in Joined Explores
        </a>
      </h2>
    <p>When an explore is joined in, it becomes a nested field within the source explore. Fields within the joined explore can be referenced by first naming the joined explore, then accessing a contained field using <code class="language-malloy"><span class="token punctuation">.</span></code>.</p>
<pre class="language-malloy"><span class="token keyword">explore</span> flights
<span class="token operator">|</span> <span class="token keyword">reduce</span>
  carriers<span class="token punctuation">.</span>nickname
  flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights
  | ^</div><p>Measures and queries defined in joined explores may be used in addition to dimensions.</p>
<pre class="language-malloy"><span class="token keyword">explore</span> flights
<span class="token operator">|</span> <span class="token keyword">reduce</span>
  destination_code
  carriers<span class="token punctuation">.</span>carrier_count</pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: extraneous input 'explore' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | explore flights
  | ^</div>
      <h2>
        <a id="join-example" class="header-link anchor" href="#join-example">
          Join Example
        </a>
      </h2>
    <p>This example demonstrates the definition of several different joins in a model and their use in a query.</p>
<pre class="language-malloy"><span class="token comment">/* Data about particular kinds of aircraft */</span>
<span class="token keyword">define</span> aircraft_models <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.aircraft_models'</span>
  primary <span class="token keyword">key</span> aircraft_model_code
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Individual airplanes */</span>
<span class="token keyword">define</span> aircraft <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.aircraft'</span>
  primary <span class="token keyword">key</span> tail_num
  aircraft_models <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> aircraft_model_code
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* The airports that the aircraft fly to and from */</span>
<span class="token keyword">define</span> airports <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.airports'</span>
  primary <span class="token keyword">key</span> code
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Each individual flight */</span>
<span class="token keyword">define</span> flights <span class="token keyword">is</span> <span class="token punctuation">(</span><span class="token keyword">explore</span> <span class="token string">'malloy-data.faa.flights'</span>
    aircraft <span class="token keyword">is</span> <span class="token keyword">join</span> <span class="token keyword">on</span> tail_num
    origin_airport <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> origin
    destination_airport <span class="token keyword">is</span> <span class="token keyword">join</span> airports <span class="token keyword">on</span> destination
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">explore</span> flights : <span class="token punctuation">[</span>
  dep_time : <span class="token date">@2003-01</span><span class="token punctuation">,</span>
  origin_airport<span class="token punctuation">.</span>code : <span class="token string">'SJC'</span>
<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">reduce</span>
  destination_code <span class="token keyword">is</span> destination_airport<span class="token punctuation">.</span>code
  flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  aircraft_count <span class="token keyword">is</span> aircraft<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  aircraft_model_count <span class="token keyword">is</span> aircraft<span class="token punctuation">.</span>aircraft_models<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre><div class="error">Error: Error: Error(s) compiling model:
FILE: internal://internal.malloy
line 2: mismatched input 'define' expecting {<EOF>, EXPLORE, QUERY, IMPORT, ';'}
  | define aircraft_models is (explore 'malloy-data.faa.aircraft_models'
  | ^</div><p>For more examples and how to reason about aggregation across joins, review the <a href="aggregates.html">Aggregates</a> section.</p>
</div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>