<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Malloy Documentation</title>
    <link rel="stylesheet" href="/malloy/css/document.css">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/>
  </head>
  <body>
    <div class="top">
      <div class="header">
        <img src="/malloy/img/logo.png" alt="malloy logo"/>Malloy <span class="subtitle">Documentation</span>
      </div>
      <div class="main">
        <div class="sidebar">
    <div>
        <div class="sidebar-section-title">Getting Started</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/index.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Tao of Malloy
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/features.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Key Features
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Language Reference</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/language/overview.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Introduction
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/basic.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Malloy Quickstart
            </a>
          </div>
<div class='sidebar-item active'>
            <a href="/malloy/documentation/language/statement.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Models
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/explore.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Explores
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/query.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Queries
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/fields.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Fields
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/types.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Types
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/expressions.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Expressions
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/order_by.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Ordering and Limiting
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/join.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Joins
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/filters.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Filters
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/nesting.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Nested Queries
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/aggregates.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Aggregates
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/language/imports.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Imports and Exports
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Common Patterns</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/yoy.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Year Over Year Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/foreign_sums.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Foreign Sums and Averages
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/percent_of_total.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Percent of Total
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/cohorts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Cohort Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/pivot_limits.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Pivot Limits
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/patterns/sessionize.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Sessionized Data
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Rendering Results</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/dashboards.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Tables and Dashboards
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/bar_charts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Bar Charts
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/charts_line_chart.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Line Charts
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/shape_maps.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Shape Maps
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/segment_maps.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Segment Maps
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/visualizations/scatter_charts.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Scatter Charts
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Examples</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/examples/ecommerce.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              eCommerce Analysis
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/faa.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              NTSB Flight Database
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/names.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Name Game
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/ga_sessions.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Google Analytics GA360
            </a>
          </div>
      </div>
<div>
        <div class="sidebar-section-title">Iowa Liquor - An Analysis</div>
        <div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/iowa.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              About the Data Set
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/source.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              The Malloy Data Model
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step2.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Basic Calculations
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step2a.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Analysis: Products and Brands
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step3.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Bucketing and Mapping
            </a>
          </div>
<div class='sidebar-item '>
            <a href="/malloy/documentation/examples/iowa/step6.html">
              <img src="/malloy/img/docs-page.svg" alt="document"/>
              Dashboards
            </a>
          </div>
      </div>

  </div>
        <div class="content">
          <div class="footer">
            
            <div class="linear-navigation">
    <div class="item">
      <a href="basic.html"><img src="/malloy/img/previous.svg" alt="previous"/>Malloy Quickstart</a>
    </div>
    <div class="item">
      <a href="explore.html">Explores<img src="/malloy/img/next.svg" alt="next"/></a>
    </div>
  </div>
            
          </div>
          <div class="document-outer">
            <div class="document">
      <h1>
        <a id="models" class="header-link anchor" href="#models">
          Models
        </a>
      </h1>
    <p>Malloy recognizes modeling as a key aspect of data analyitics and
provides tools that allow for modularity and reusability of definitions.
Whereas in SQL, queries generally define all metrics inline,
requiring useful snippets to be saved and managed separately, in Malloy,
<em>dimensions</em>, <em>measures</em>, and <em>queries</em> can be saved and attached to a
modeled <em>explore</em>.</p>

      <h2>
        <a id="explores" class="header-link anchor" href="#explores">
          Explores
        </a>
      </h2>
    <p>A Malloy model file can contain several <em>explores</em>, which define fields that can be
used in queries.</p>
<pre class="language-malloy"><span class="token keyword">explore</span>: flights <span class="token keyword">is</span> <span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'malloy-data.faa.flights'</span><span class="token punctuation">)</span>{
  <span class="token keyword">dimension</span>: distance_km <span class="token keyword">is</span> distance <span class="token operator">/</span> <span class="token number">1.609344</span>

  <span class="token keyword">measure</span>: flight_count <span class="token keyword">is</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">query</span>: by_carrier <span class="token keyword">is</span>  {
    <span class="token keyword">group_by</span>: carrier
    <span class="token keyword">aggregate</span>: flight_count
  }
}</pre><p>See <a href="explore.html">here</a> for more information on explores.</p>

      <h2>
        <a id="queries" class="header-link anchor" href="#queries">
          Queries
        </a>
      </h2>
    
      <h3>
        <a id="using-modeled-in-query-" class="header-link anchor" href="#using-modeled-in-query-">
          Using modeled in query.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>by_carrier</pre><div class="result-outer small">
    <div class="result-middle">
      <div class="result-inner">
        <pre>[
  {
    "carrier": "WN",
    "flight_count": 5775777
  },
  {
    "carrier": "DL",
    "flight_count": 4477929
  },
  {
    "carrier": "AA",
    "flight_count": 4434727
  },
  {
    "carrier": "UA",
    "flight_count": 3654646
  },
  {
    "carrier": "US",
    "flight_count": 3205810
  }
]</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="using-modeled-with-a-filter-" class="header-link anchor" href="#using-modeled-with-a-filter-">
          Using modeled with a filter.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights{<span class="token keyword">where</span>: origin: <span class="token string">'SFO'</span>}<span class="token operator">-</span><span class="token operator">></span>by_carrier</pre><div class="result-outer small">
    <div class="result-middle">
      <div class="result-inner">
        <pre>[
  {
    "carrier": "UA",
    "flight_count": 338723
  },
  {
    "carrier": "OO",
    "flight_count": 105581
  },
  {
    "carrier": "AA",
    "flight_count": 82468
  },
  {
    "carrier": "DL",
    "flight_count": 44694
  },
  {
    "carrier": "AS",
    "flight_count": 32351
  }
]</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="setting-a-limit-on-the-query" class="header-link anchor" href="#setting-a-limit-on-the-query">
          Setting a limit on the Query
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights{<span class="token keyword">where</span>: origin: <span class="token string">'SFO'</span>}<span class="token operator">-</span><span class="token operator">></span>by_carrier{<span class="token keyword">limit</span>: <span class="token number">2</span>}</pre><div class="result-outer small">
    <div class="result-middle">
      <div class="result-inner">
        <pre>[
  {
    "carrier": "UA",
    "flight_count": 338723
  },
  {
    "carrier": "OO",
    "flight_count": 105581
  }
]</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="creating-a-brand-new-query-" class="header-link anchor" href="#creating-a-brand-new-query-">
          Creating a brand new Query.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">group_by</span>: destination
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    flight_count
    average_distance_in_km <span class="token keyword">is</span> distance_km<span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}</pre><div class="result-outer small">
    <div class="result-middle">
      <div class="result-inner">
        <pre>[
  {
    "destination": "ORD",
    "flight_count": 2036343,
    "average_distance_in_km": 480.7323051917168
  },
  {
    "destination": "ATL",
    "flight_count": 1963535,
    "average_distance_in_km": 403.98744415851746
  },
  {
    "destination": "DFW",
    "flight_count": 1812062,
    "average_distance_in_km": 490.64446861037715
  },
  {
    "destination": "LAX",
    "flight_count": 1300241,
    "average_distance_in_km": 631.2922437299272
  },
  {
    "destination": "PHX",
    "flight_count": 1059054,
    "average_distance_in_km": 554.5763958814941
  }
]</pre>
      </div>
    </div>
  </div>
      <h3>
        <a id="putting-it-all-together-" class="header-link anchor" href="#putting-it-all-together-">
          Putting it all together.
        </a>
      </h3>
    <pre class="language-malloy"><span class="token keyword">query</span>: flights<span class="token operator">-</span><span class="token operator">></span>{
  <span class="token keyword">group_by</span>: destination
  <span class="token keyword">aggregate</span>: <span class="token punctuation">[</span>
    flight_count
    average_distance_in_km <span class="token keyword">is</span> distance_km<span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">nest</span>: top_carriers <span class="token keyword">is</span> by_carrier{<span class="token keyword">limit</span>: <span class="token number">2</span>}
}</pre><div class="result-outer small">
    <div class="result-middle">
      <div class="result-inner">
        <pre>[
  {
    "destination": "ORD",
    "flight_count": 2036343,
    "average_distance_in_km": 480.73230519172,
    "top_carriers": [
      {
        "carrier": "UA",
        "flight_count": 754774
      },
      {
        "carrier": "AA",
        "flight_count": 597817
      }
    ]
  },
  {
    "destination": "ATL",
    "flight_count": 1963535,
    "average_distance_in_km": 403.9874441585156,
    "top_carriers": [
      {
        "carrier": "DL",
        "flight_count": 1247710
      },
      {
        "carrier": "EV",
        "flight_count": 288405
      }
    ]
  },
  {
    "destination": "DFW",
    "flight_count": 1812062,
    "average_distance_in_km": 490.6444686103775,
    "top_carriers": [
      {
        "carrier": "AA",
        "flight_count": 968201
      },
      {
        "carrier": "MQ",
        "flight_count": 379017
      }
    ]
  },
  {
    "destination": "LAX",
    "flight_count": 1300241,
    "average_distance_in_km": 631.2922437299284,
    "top_carriers": [
      {
        "carrier": "UA",
        "flight_count": 272279
      },
      {
        "carrier": "WN",
        "flight_count": 243946
      }
    ]
  },
  {
    "destination": "PHX",
    "flight_count": 1059054,
    "average_distance_in_km": 554.5763958814887,
    "top_carriers": [
      {
        "carrier": "HP",
        "flight_count": 433442
      },
      {
        "carrier": "WN",
        "flight_count": 381772
      }
    ]
  }
]</pre>
      </div>
    </div>
  </div><p>See <a href="query.html">here</a> for more information on queries.</p>
</div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>